var _ref,__bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(d,b){for(var a in b){if(__hasProp.call(b,a)){d[a]=b[a]}}function c(){this.constructor=d}c.prototype=b.prototype;d.prototype=new c();d.__super__=b.prototype;return d},createDateFromISO8601=function(b){var h,a,g,e,f,c;e="([0-9]{4})(-([0-9]{2})(-([0-9]{2})(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(\\.([0-9]+))?)?(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?";h=b.match(new RegExp(e));g=0;a=new Date(h[1],0,1);if(h[3]){a.setMonth(h[3]-1)}if(h[5]){a.setDate(h[5])}if(h[7]){a.setHours(h[7])}if(h[8]){a.setMinutes(h[8])}if(h[10]){a.setSeconds(h[10])}if(h[12]){a.setMilliseconds(Number("0."+h[12])*1000)}if(h[14]){g=(Number(h[16])*60)+Number(h[17]);g*=(c=h[15]==="-")!=null?c:{1:-1}}g-=a.getTimezoneOffset();f=Number(a)+(g*60*1000);a.setTime(Number(f));return a};var Util=typeof Util!="undefined"?Util:{};Util.mousePosition=function(b,d){var c,a;if((a=$(d).css("position"))!=="absolute"&&a!=="fixed"&&a!=="relative"){d=$(d).offsetParent()[0]}c=$(d).offset();return{top:b.pageY-c.top,left:b.pageX-c.left}};(function(){function b(f,e){var g=this;g.annotations=new a(g,f);function i(n){var m=g.annotations;for(var l in m.components){m.components[l].init_()}g.annotations.BigNewAn.show();var p=$(".annotator-wrapper").parent()[0],o=$.data(p,"annotator");m.setposBigNew(m.options.posBigNew);if(!f.showDisplay){m.hideDisplay()}m.BackAnDisplay.el_.style.height=(m.options.NumAnnotations+"em");m.BackAnDisplay.el_.style.top="-"+(m.options.NumAnnotations+2+"em");m.BackAnDisplayScroll.el_.children[0].style.top="-"+(m.options.NumAnnotations+4+"em");o.mplayer[g.id_]=g;o.an[g.id_]=m;g.annotator=o;m.annotator=o;var k=o.plugins.Store.annotations;g.allannotations=k;m.refreshDisplay();console.log(k);this.onKeyUp=function(){console.log("ok")};g.rangeslider.rstb.on("mousedown",function(){m._onMouseDownRS(n)});if(this.autoPlayAPI){g.annotations.showAnnotation(this.autoPlayAPI,true);$("html,body").animate({scrollTop:$("#"+g.id_).offset().top},"slow")}}this.on("durationchange",i);if(typeof e!="undefined"&&typeof e.method!="undefined"&&(e.method=="1"||e.method=="2")){if(e.method=="1"){console.log("method 1")}else{if(e.method=="2"){console.log("method 2");var j=decodeURIComponent(e.src),d=g.tag.src==""?g.tag.currentSrc:g.tag.src;container=decodeURIComponent(e.container),isContainer=(container==g.id_),isNumber=(!isNaN(parseFloat(e.start))&&isFinite(e.start)&&!isNaN(parseFloat(e.end))&&isFinite(e.end)),isSource=false;if(isContainer){var h=j.substring(0,j.lastIndexOf(".")),d=d.substring(0,d.lastIndexOf("."));isSource=(h==d)}if(isContainer&&isNumber&&isSource){var c={rangeTime:{start:e.start,end:e.end},created:new Date().toISOString(),updated:new Date().toISOString(),target:{container:container,src:j},media:"video",text:decodeURIComponent(e.text),user:decodeURIComponent(e.user)};vjs(g.id_).ready(function(){var l=$(".annotator-wrapper").parent()[0],k=window.annotator=$.data(l,"annotator");k.subscribe("annotationsLoaded",function(m){g.preload("auto");g.play()});this.autoPlayAPI=c})}}}}console.log("Loaded Annotation Plugin")}videojs.plugin("annotations",b);function a(d,c){var d=d||this;this.player=d;this.components={};c=c||{};if(!c.hasOwnProperty("posBigNew")){c.posBigNew="ul"}if(!c.hasOwnProperty("showDisplay")){c.showDisplay=false}if(!c.hasOwnProperty("NumAnnotations")){c.NumAnnotations=16}this.options=c;this.init()}a.prototype={init:function(){var c=this.player||{},e=c.controlBar,d=c.controlBar.progressControl.seekBar;this.NewAn=this.components.NewAnnotation=e.NewAnnotation;this.BigNewAn=this.components.BigNewAnnotation=c.BigNewAnnotation;this.ShowAn=this.components.ShowAnnotations=e.ShowAnnotations;this.BackAnDisplay=this.components.BackAnDisplay=e.BackAnDisplay;this.AnDisplay=this.components.AnDisplay=e.BackAnDisplay.AnDisplay;this.BackAnDisplayScroll=this.components.BackAnDisplayScroll=e.BackAnDisplayScroll;this.rs=c.rangeslider;this.editing=false;this.BigNewAn.hide()},newan:function(i,c){var d=this.player,h=this.annotator,g=10,e=d.currentTime(),f=this._sumPercent(e,g);var i=typeof i!="undefined"?i:e,c=typeof c!="undefined"?c:f;this._reset();d.showSlider();d.pause();d.setValueSlider(i,c);h.editor.VideoJS=this.player.id_;h.adder.show();this._setOverRS(h.adder);h.onAdderClick()},showDisplay:function(){this._reset();this.BackAnDisplay.removeClass("disable");this.BackAnDisplayScroll.removeClass("disable");videojs.addClass(this.ShowAn.el_,"active");this.options.showDisplay=true},hideDisplay:function(){this.BackAnDisplay.addClass("disable");this.BackAnDisplayScroll.addClass("disable");videojs.removeClass(this.ShowAn.el_,"active");this.options.showDisplay=false},showAnnotation:function(c){var h=this._isVideoJS(c);if(h){var i=c.rangeTime.start,d=c.rangeTime.end;this._reset();this.rs.show();this.rs.setValues(i,d);this.rs.lock();this.rs.playBetween(i,d);var g=this.rs.bar.el_,e=$(this.rs.left.el_).parent()[0];$(e).append('<span class="annotator-hl"></div>');$(g).appendTo($(e).find(".annotator-hl"));var f=$(g).parent()[0];$.data(f,"annotation",c);c.highlights=f;this._setOverRS(this.annotator.editor.element);this.annotator.editor.checkOrientation();this.rs.hidePanel()}},hideAnnotation:function(){this.rs.hide();this.rs.showPanel();var d=this.rs.bar.el_,c=$(this.rs.left.el_).parent()[0];if($(c).find(".annotator-hl").length>0){$(d).appendTo(c);$(c).find(".annotator-hl").remove()}},editAnnotation:function(c,e){if(this._isVideoJS(c)){this.hideDisplay();var d=this.player,e=e||this.annotator.editor;d.showSlider();d.unlockSlider();d.setValueSlider(c.rangeTime.start,c.rangeTime.end);d.showSliderPanel();this._setOverRS(e.element);e.checkOrientation();this.annotator.editor.VideoJS=d.id_}},refreshDisplay:function(){console.log("loadingAnnotations");var h=0,j=this.player.allannotations;this._sortByDate(j);$(this.AnDisplay.el_).find("span").remove();$(this.player.el_).find(".vjs-anpanel-annotation .annotation").remove();for(var k in j){var g=j[k];if(this._isVideoJS(g)){var c=document.createElement("div"),i=document.createElement("span"),e=this.rs._percent(g.rangeTime.start)*100,f=this.rs._percent(g.rangeTime.end)*100,d;i.appendChild(c);i.className="annotator-hl";d=Math.min(100,Math.max(0,f-e));c.className="annotation";c.id=h;c.style.top=h+"em";c.style.left=e+"%";c.style.width=d+"%";c.start=g.rangeTime.start;c.end=g.rangeTime.end;this.AnDisplay.el_.appendChild(i);$.data(i,"annotation",g);g.highlights=$(i);h++}}},setposBigNew:function(d){var d=d||"ul",c=this.player.BigNewAnnotation.el_;videojs.removeClass(c,"ul");videojs.removeClass(c,"ur");videojs.removeClass(c,"c");videojs.removeClass(c,"bl");videojs.removeClass(c,"br");videojs.addClass(c,d)},pressedKey:function(e){var d=this.player,c=this.player.rs;if(typeof e!="undefined"&&e==73){this._reset();this.rs.show();this.rs._reset();this.rs.setValue(0,d.currentTime());this.rs.right.el_.style.visibility="hidden";this.rs.tpr.el_.style.visibility="hidden";this.rs.ctpr.el_.style.visibility="hidden";this.rs.bar.el_.style.visibility="hidden";this.lastStartbyKey=d.currentTime()}else{if(typeof e!="undefined"&&e==79){if(this.rs.bar.el_.style.visibility=="hidden"){var f=this.lastStartbyKey!="undefined"?this.lastStartbyKey:0;this.newan(f,d.currentTime())}else{this.newan(d.currentTime(),d.currentTime())}}}},_reset:function(){this.hideDisplay();this.hideAnnotation();this.player.annotator.adder.hide();this.player.annotator.editor.hide();this.player.annotator.viewer.hide();this.rs.right.el_.style.visibility="";this.rs.tpr.el_.style.visibility="";this.rs.ctpr.el_.style.visibility="";this.rs.bar.el_.style.visibility="";this.rs.unlock();this.rs.bar.suspendPlay()},_setOverRS:function(g){var i=this.player.annotator,h=$(".annotator-wrapper")[0],c=videojs.findPosition(this.rs.left.el_),f=videojs.findPosition(this.rs.right.el_),e=videojs.findPosition(h),d={};g[0].style.display="block";d.left=c.left+(f.left-c.left)/2-e.left;d.top=c.top-e.top;g.css(d)},_onMouseDownRS:function(c){c.preventDefault();videojs.blockTextSelection();if(!this.rs.options.locked){videojs.on(document,"mousemove",videojs.bind(this,this._onMouseMoveRS));videojs.on(document,"mouseup",videojs.bind(this,this._onMouseUpRS))}},_onMouseMoveRS:function(e){var d=this.player,f=d.annotator,c=d.rangeslider;f.editor.element[0].style.display="none";c.show();this._setOverRS(f.adder)},_onMouseUpRS:function(e){videojs.off(document,"mousemove",this._onMouseMoveRS,false);videojs.off(document,"mouseup",this._onMouseUpRS,false);var d=this.player,f=d.annotator,c=d.rangeslider;f.editor.element[0].style.display="block";this._setOverRS(f.editor.element)},_sumPercent:function(e,c){var d=this.player.duration();var e=e||0;var c=c||10;c=Math.min(100,Math.max(0,c));if(isNaN(d)){return 0}return Math.min(d,Math.max(0,e+d*c/100))},_EditVideoAn:function(){var e=this.annotator,d=(typeof this.player!="undefined"),c=e.editor.VideoJS;return(d&&typeof c!="undefined"&&c!=-1)},_isVideoJS:function(i){var l=this.player,e=l.annotator,g=i.rangeTime,k=(typeof this.player!="undefined"),c=(typeof i.media!="undefined"&&i.media=="video"),d=(typeof i.target!="undefined"&&i.target.container==l.id_),m=(typeof g!="undefined"&&!isNaN(parseFloat(g.start))&&isFinite(g.start)&&!isNaN(parseFloat(g.end))&&isFinite(g.end)),j=false;if(d){var f=i.target.src.substring(0,i.target.src.lastIndexOf(".")),h=l.tag.currentSrc.substring(0,l.tag.currentSrc.lastIndexOf("."));j=(f==h)}return(k&&c&&d&&j&&m)},_sortByDate:function(d,c){var c=c||"asc";d.sort(function(f,e){f=new Date(createDateFromISO8601(f.updated));e=new Date(createDateFromISO8601(e.updated));if(c=="asc"){return e<f?-1:e>f?1:0}else{return f<e?-1:f>e?1:0}})}};videojs.ControlBar.prototype.options_.children.ShowAnnotations={};videojs.ControlBar.prototype.options_.children.NewAnnotation={};videojs.ControlBar.prototype.options_.children.BackAnDisplay={};videojs.ControlBar.prototype.options_.children.BackAnDisplayScroll={};videojs.options.children.BigNewAnnotation={};videojs.NewAnnotation=videojs.Button.extend({init:function(d,c){videojs.Button.call(this,d,c)}});videojs.NewAnnotation.prototype.init_=function(){this.rs=this.player_.rangeslider;this.an=this.player_.annotations};videojs.NewAnnotation.prototype.createEl=function(){return videojs.Button.prototype.createEl.call(this,"div",{className:"vjs-new-annotation vjs-menu-button vjs-control",})};videojs.NewAnnotation.prototype.onClick=function(){this.an.newan()};videojs.BigNewAnnotation=videojs.Button.extend({init:function(d,c){videojs.Button.call(this,d,c)}});videojs.BigNewAnnotation.prototype.init_=function(){this.rs=this.player_.rangeslider;this.an=this.player_.annotations};videojs.BigNewAnnotation.prototype.createEl=function(){return videojs.Button.prototype.createEl.call(this,"div",{className:"vjs-big-new-annotation vjs-menu-button vjs-control",innerHTML:'<div class="vjs-big-menu-button vjs-control">A</div>'})};videojs.BigNewAnnotation.prototype.onClick=function(){this.an.newan()};videojs.ShowAnnotations=videojs.Button.extend({init:function(d,c){videojs.Button.call(this,d,c)}});videojs.ShowAnnotations.prototype.init_=function(){this.rs=this.player_.rangeslider;this.an=this.player_.annotations};videojs.ShowAnnotations.prototype.createEl=function(){return videojs.Button.prototype.createEl.call(this,"div",{className:"vjs-showannotations-annotation vjs-menu-button vjs-control",innerHTML:'<div class="vjs-menu-button vjs-control">S</div>'})};videojs.ShowAnnotations.prototype.onClick=function(){if(!this.an.options.showDisplay){this.an.showDisplay()}else{this.an.hideDisplay()}};videojs.BackAnDisplay=videojs.Component.extend({init:function(d,c){videojs.Component.call(this,d,c)}});videojs.BackAnDisplay.prototype.init_=function(){this.rs=this.player_.rangeslider;this.an=this.player_.annotations};videojs.BackAnDisplay.prototype.options_={children:{AnDisplay:{},}};videojs.BackAnDisplay.prototype.createEl=function(){return videojs.Component.prototype.createEl.call(this,"div",{className:"vjs-back-anpanel-annotation",})};videojs.BackAnDisplayScroll=videojs.Component.extend({init:function(d,c){videojs.Component.call(this,d,c);this.on("mousedown",this.onMouseDown)}});videojs.BackAnDisplayScroll.prototype.init_=function(){this.rs=this.player_.rangeslider;this.an=this.player_.annotations;this.mousedownID=-1};videojs.BackAnDisplayScroll.prototype.createEl=function(){return videojs.Component.prototype.createEl.call(this,"div",{className:"vjs-scroll-anpanel-annotation",innerHTML:'<div class="vjs-up-scroll-annotation"></div><div class="vjs-down-scroll-annotation"></div>',})};videojs.BackAnDisplayScroll.prototype.onMouseDown=function(d){var e=d.target.className=="vjs-down-scroll-annotation"?10:-10;videojs.on(document,"mouseup",videojs.bind(this,this.onMouseUp));var c=this.an.AnDisplay.el_;if(this.mousedownID==-1){this.mousedownID=setInterval(function(){c.scrollTop=(c.scrollTop+e)},100)}};videojs.BackAnDisplayScroll.prototype.onMouseUp=function(c){videojs.off(document,"mouseup",this.onMouseUp,false);if(this.mousedownID!=-1){clearInterval(this.mousedownID);this.mousedownID=-1}};videojs.AnDisplay=videojs.Component.extend({init:function(d,c){videojs.Component.call(this,d,c);this.on("mousedown",this.onMouseDown);this.on("mouseover",this.onMouseOver)}});videojs.AnDisplay.prototype.init_=function(){this.rs=this.player_.rangeslider;this.an=this.player_.annotations;this.transition=false};videojs.AnDisplay.prototype.createEl=function(){return videojs.Component.prototype.createEl.call(this,"div",{className:"vjs-anpanel-annotation",})};videojs.AnDisplay.prototype.onMouseDown=function(g){var f=$(g.target).parents(".annotator-hl").andSelf(),d=this;if(f.hasClass("annotator-hl")){videojs.on(document,"mouseup",videojs.bind(this,this.onMouseUp));var e=document.createElement("div"),h=parseFloat(f[1].style.top),c=parseFloat($(f[1]).css("height"));e.className="boxup-dashed-line";e.style.left=f[1].style.left;e.style.width=f[1].style.width;e.style.top=(h-this.el_.scrollTop/c)+"em";f[0].parentNode.parentNode.appendChild(e)}};videojs.AnDisplay.prototype.onMouseUp=function(h){if(typeof this.lastelem=="undefined"){return false}var g=this.lastelem,e=this;if(g.hasClass("annotator-hl")){var d=g.map(function(){return $(this).data("annotation")})[0];var f=(-1)*parseFloat($(this.el_).parent()[0].style.top),c=parseFloat($(g[1]).css("height"));$(g).parent().parent().find(".boxup-dashed-line")[0].style.top=(f-2)+"em";this.an.player.pause();this.transition=true;window.setTimeout(function(){e.an.showAnnotation(d);e.transition=false;e.onCloseViewer()},900)}videojs.off(document,"mouseup",this.onMouseUp,false)};videojs.AnDisplay.prototype.onMouseOver=function(c){if(!this.transition){var d=this.an.annotator;var f=$(c.target).parents(".annotator-hl").andSelf();if(typeof d!="undefined"&&d.viewer.isShown()&&f.hasClass("annotator-hl")){d.viewer.hide();var i=f.map(function(){return $(this).data("annotation")});d.showViewer($.makeArray(i),Util.mousePosition(c,d.wrapper[0]))}f.addClass("active");if(typeof f!="undefined"&&$(f[1]).hasClass("annotation")){var h=document.createElement("div"),j=document.createElement("div"),k=parseFloat(this.an.BackAnDisplay.el_.style.height),e=parseFloat(f[1].style.top),g=parseFloat($(f[1]).css("height"));h.className="dashed-line";j.className="box-dashed-line";h.style.left=j.style.left=f[1].style.left;h.style.width=j.style.width=f[1].style.width;h.style.top=((e+1)-this.el_.scrollTop/g)+"em";h.style.height=((k-e+1)+this.el_.scrollTop/g)+"em";j.style.top=(k+1)+"em";f[0].parentNode.parentNode.appendChild(h);f[0].parentNode.parentNode.appendChild(j);$(this.player).find(".vjs-play-progress").css("z-index",2);$(this.player).find(".vjs-seek-handle").css("z-index",2)}if(f.hasClass("annotator-hl")){this.lastelem=f}}};videojs.AnDisplay.prototype.onCloseViewer=function(){if(!this.transition){if(typeof this.lastelem!="undefined"){this.lastelem.removeClass("active")}if(typeof this.lastelem!="undefined"&&this.lastelem.hasClass("annotator-hl")){$(this.lastelem).parent().parent().find(".dashed-line").remove();$(this.lastelem).parent().parent().find(".box-dashed-line").remove();$(this.lastelem).parent().parent().find(".boxup-dashed-line").remove();$(this.player).find(".vjs-play-progress").css("z-index","");$(this.player).find(".vjs-seek-handle").css("z-index","")}}}})();Annotator.Plugin.VideoJS=(function(b){__extends(a,b);function a(){this.pluginSubmit=__bind(this.pluginSubmit,this);this.updateField=__bind(this.updateField,this);_ref=a.__super__.constructor.apply(this,arguments);this.__indexOf=[].indexOf||function(e){for(var d=0,c=this.length;d<c;d++){if(d in this&&this[d]===e){return d}}return -1};return _ref}a.prototype.field=null;a.prototype.input=null;a.prototype.pluginInit=function(){console.log("Plug-pluginInit");if(!Annotator.supported()){return}this.field=this.annotator.editor.addField({id:"vjs-input-rangeTime-annotations",type:"input",submit:this.pluginSubmit,EditVideoAn:this.EditVideoAn});var c='<li><span id="vjs-input-rangeTime-annotations"></span></li>',d=Annotator.$(c);Annotator.$(this.field).replaceWith(d);this.field=d[0];this.annotator.viewer.addField({load:this.updateViewer});this.initListeners();return this.input=$(this.field).find(":input")};a.prototype.updateField=function(d,c){console.log("Plug-updateField")};a.prototype.pluginSubmit=function(i,c){console.log("Plug-pluginSubmit");if(this.EditVideoAn()){var e=this.annotator.editor.VideoJS,f=this.annotator.mplayer[e],d=f.rangeslider,h=d.getValues(),g;c.media="video";c.target=c.target||{};c.target.container=f.id_||"";c.target.src=f.tag.currentSrc||"";g=(f.tag.currentSrc.substring(f.tag.currentSrc.lastIndexOf("."))).toLowerCase();c.target.ext=g||"";c.rangeTime=c.rangeTime||{};c.rangeTime.start=h.start||0;c.rangeTime.end=h.end||0;c.updated=new Date().toISOString();if(typeof c.created=="undefined"){c.created=new Date().toISOString()}}else{if(typeof c.media=="undefined"){c.media="text"}}return c.media};a.prototype.updateViewer=function(d,c){console.log("Plug-updateViewer")};a.prototype.EditVideoAn=function(){var f=$(".annotator-wrapper").parent()[0],e=window.annotator=$.data(f,"annotator"),d=(typeof e.mplayer!="undefined"),c=e.editor.VideoJS;return(d&&typeof c!="undefined"&&c!=-1)};a.prototype.isVideoJS=function(f){var i=$(".annotator-wrapper").parent()[0],h=window.annotator=$.data(i,"annotator"),c=f.rangeTime,e=(typeof h.mplayer!="undefined"),g=(typeof f.media!="undefined"&&f.media=="video"),d=(typeof c!="undefined"&&!isNaN(parseFloat(c.start))&&isFinite(c.start)&&!isNaN(parseFloat(c.end))&&isFinite(c.end));return(e&&g&&d)};a.prototype._deleteAnnotation=function(f){var h=f.target||{},c=h.container||{},i=this.annotator,e=i.mplayer[c],g=e.annotations,d;d=this.__indexOf.call(e.allannotations,f);if(d>=0){if(typeof e.allannotations[d]!="undefined"){delete e.allannotations[d]}e.rangeslider.hide();g.refreshDisplay()}};a.prototype.initListeners=function(){var g=$(".annotator-wrapper").parent()[0],f=$.data(g,"annotator");var e=this.EditVideoAn,d=this.isVideoJS,c=this;this.annotator.subscribe("annotationEditorShown",function(j,h){console.log("annotationEditorShown");for(var i in f.an){f.an[i].editAnnotation(h,j)}}).subscribe("annotationEditorHidden",function(i){console.log("annotationEditorHidden");if(e()){var h=f.editor.VideoJS;f.mplayer[h].rangeslider.hide();f.an[h].refreshDisplay()}f.editor.VideoJS=-1}).subscribe("annotationDeleted",function(h){console.log("annotationDeleted");if(d(h)){c._deleteAnnotation(h)}}).subscribe("annotationViewerShown",function(k,j){console.log("annotationViewerShown");var h=k.element.hasClass(k.classes.invert.y)?5:-5,i={top:parseFloat(k.element[0].style.top)+h,left:parseFloat(k.element[0].style.left)};k.element.css(i);k.element.find(".annotator-controls").removeClass(k.classes.showControls)});this.annotator.viewer.subscribe("hide",function(){for(var h in f.an){f.an[h].AnDisplay.onCloseViewer()}})};return a})(Annotator.Plugin);OpenVideoAnnotation=("OpenVideoAnnotation" in window)?OpenVideoAnnotation:{};OpenVideoAnnotation.Annotator=function(b,d){var g=jQuery,d=d||{};d.optionsAnnotator=d.optionsAnnotator||{
				user: { },

				store: {
					// The endpoint of the store on your server.
					prefix: 'http://danielcebrian.com/annotations/api',

					// Attach the uri of the current page to all annotations to allow search.
					annotationData: {
						'uri': 'http://danielcebrian.com/annotations/demo.html'
					},

					// This will perform a "search" action rather than "read" when the plugin
					// loads. Will request the last 20 annotations for the current url.
					// eg. /store/endpoint/search?limit=20&uri=http://this/document/only
					loadFromSearch: {
						'limit': 10000,
						'uri': 'http://danielcebrian.com/annotations/demo.html'
					}
				}
			};d.optionsVideoJS=d.optionsVideoJS||{};d.optionsRS=d.optionsRS||{};d.optionsOVA=d.optionsOVA||{};this.currentUser=null;this.annotator=g(b).annotator().data("annotator");var n=g(b).find("div .video-js").toArray();var e=this.mplayer={};for(var i in n){var p=n[i].id;var s=videojs(n[i],d.optionsVideoJS);this.mplayer[p]=s}function r(u){u=u.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var w=new RegExp("[\\?&]"+u+"=([^&#]*)"),v=w.exec(location.search);return v==null?"":decodeURIComponent(v[1].replace(/\+/g," "))}var q={},k=r("ovaId"),h=r("ovaStart"),f=r("ovaEnd"),l=r("ovaContainer"),j=r("ovaSrc"),m=r("ovaText"),t=r("ovaUser");if(k!=""){g.extend(q,{method:1,ovaId:k})}if(h!=""&&f!=""&&l!=""&&j!=""){g.extend(q,{method:2,start:h,end:f,container:l,src:j,text:m,user:t})}this.annotator.addPlugin("Permissions",d.optionsAnnotator.user);this.annotator.addPlugin("Store",d.optionsAnnotator.store);this.annotator.addPlugin("Tags");this.annotator.addPlugin("VideoJS");this.annotator.mplayer={};this.annotator.an={};this.annotator.editor.VideoJS=-1;for(var i in this.mplayer){this.mplayer[i].rangeslider(g.extend(true,{},d.optionsRS));this.mplayer[i].annotations(g.extend(true,{},d.optionsOVA),q)}this.setCurrentUser=function(u){this.currentUser=u;this.annotator.plugins.Permissions.setUser(u)};var o=this.focusedPlayer="",a=this.lastfocusPlayer="";function c(u){if(u.target.nodeName.toLowerCase()!="textarea"){e[o].annotations.pressedKey(u.which)}}(this._setupKeyboard=function(){g(document).mousedown(function(v){o="";for(var u in e){if(g(e[u].el_).find(v.target).length){o=e[u].id_}}if(a!=o){g(document).off("keyup",c);if(o!=""){g(document).on("keyup",c)}}a=o})})(this);return this};OpenVideoAnnotation.Annotator.prototype.newVideoAn=function(a){return this.mplayer[a].annotations.newan()};OpenVideoAnnotation.Annotator.prototype.showDisplay=function(a){return this.mplayer[a].annotations.showDisplay()};OpenVideoAnnotation.Annotator.prototype.hideDisplay=function(a){return this.mplayer[a].annotations.hideDisplay()};OpenVideoAnnotation.Annotator.prototype.refreshDisplay=function(a){return this.mplayer[a].annotations.hideDisplay()};OpenVideoAnnotation.Annotator.prototype.setposBigNew=function(b,a){return this.mplayer[b].annotations.setposBigNew(a)};
