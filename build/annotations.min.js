var _ref,__bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(d,b){for(var a in b){if(__hasProp.call(b,a)){d[a]=b[a]}}function c(){this.constructor=d}c.prototype=b.prototype;d.prototype=new c();d.__super__=b.prototype;return d},createDateFromISO8601=function(b){var h,a,g,e,f,c;e="([0-9]{4})(-([0-9]{2})(-([0-9]{2})(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(\\.([0-9]+))?)?(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?";h=b.match(new RegExp(e));g=0;a=new Date(h[1],0,1);if(h[3]){a.setMonth(h[3]-1)}if(h[5]){a.setDate(h[5])}if(h[7]){a.setHours(h[7])}if(h[8]){a.setMinutes(h[8])}if(h[10]){a.setSeconds(h[10])}if(h[12]){a.setMilliseconds(Number("0."+h[12])*1000)}if(h[14]){g=(Number(h[16])*60)+Number(h[17]);g*=(c=h[15]==="-")!=null?c:{1:-1}}g-=a.getTimezoneOffset();f=Number(a)+(g*60*1000);a.setTime(Number(f));return a};var Util=typeof Util!="undefined"?Util:{};Util.mousePosition=function(b,d){var c,a;if((a=$(d).css("position"))!=="absolute"&&a!=="fixed"&&a!=="relative"){d=$(d).offsetParent()[0]}c=$(d).offset();return{top:b.pageY-c.top,left:b.pageX-c.left}};(function(a){a.extend(a.fn,{watch:function(f,d,g){var e=document.createElement("div");var c=function(i,j){i="on"+i;var h=(i in j);if(!h){j.setAttribute(i,"return;");h=typeof j[i]=="function"}return h};if(typeof(d)=="function"){g=d;d={}}if(typeof(g)!="function"){g=function(){}}d=a.extend({},{throttle:10},d);var b=function(k){var l=k.data(),m=false,h;for(var j=0;j<l.props.length;j++){h=k.css(l.props[j]);if(l.vals[j]!=h){l.vals[j]=h;m=true;break}}if(m&&l.cb){l.cb.call(k,l)}};return this.each(function(){var i=a(this),h=function(){b.call(this,i)},j={props:f.split(","),cb:g,vals:[]};a.each(j.props,function(k){j.vals[k]=i.css(j.props[k])});i.data(j);if(c("DOMAttrModified",e)){i.on("DOMAttrModified",g)}else{if(c("propertychange",e)){i.on("propertychange",g)}else{setInterval(h,d.throttle)}}})}})})(jQuery);(function(){function b(d){var e=this;e.annotations=new a(e,d);function f(j){console.log("aqui");var i=e.annotations;for(var h in i.components){i.components[h].init_()}e.annotations.BigNewAn.show();var l=$(".annotator-wrapper").parent()[0],k=$.data(l,"annotator");i.setposBigNew(i.options.posBigNew);if(!d.showDisplay){i.hideDisplay()}e.annotator=k;i.annotator=k;var g=k.plugins.Store.annotations;e.allannotations=g;console.log("va a refrescar");i.refreshDisplay();console.log(g);console.log(e.duration());e.rangeslider.rstb.on("mousedown",function(){i._onMouseDownRS(j)});if(this.autoPlayAPI){e.annotations.showAnnotation(this.autoPlayAPI,true);$("html,body").animate({scrollTop:$("#"+e.id_).offset().top},"slow")}i.BackAnDisplay.el_.style.height=i.backDSBar.el_.style.height=(i.options.NumAnnotations+"em");i.BackAnDisplay.el_.style.top=i.backDSBar.el_.style.top="-"+(i.options.NumAnnotations+2+"em");i.BackAnDisplayScroll.el_.children[0].style.top="-"+(i.options.NumAnnotations+4+"em")}var c=function(){if(e.techName=="Youtube"){f()}else{e.on("durationchange",f)}};e.on("firstplay",c);console.log("Loaded Annotation Plugin")}videojs.plugin("annotations",b);function a(d,c){var d=d||this;this.player=d;this.components={};c=c||{};if(!c.hasOwnProperty("posBigNew")){c.posBigNew="ul"}if(!c.hasOwnProperty("showDisplay")){c.showDisplay=false}if(!c.hasOwnProperty("NumAnnotations")){c.NumAnnotations=16}this.options=c;this.init()}a.prototype={init:function(){var c=this.player||{},e=c.controlBar,d=c.controlBar.progressControl.seekBar;this.updatePrecision=3;this.NewAn=this.components.NewAnnotation=e.NewAnnotation;this.BigNewAn=this.components.BigNewAnnotation=c.BigNewAnnotation;this.ShowAn=this.components.ShowAnnotations=e.ShowAnnotations;this.BackAnDisplay=this.components.BackAnDisplay=e.BackAnDisplay;this.AnDisplay=this.components.AnDisplay=e.BackAnDisplay.AnDisplay;this.BackAnDisplayScroll=this.components.BackAnDisplayScroll=e.BackAnDisplayScroll;this.backDSBar=this.components.BackAnDisplayScrollBar=this.BackAnDisplayScroll.BackAnDisplayScrollBar;this.backDSBarSel=this.components.ScrollBarSelector=this.backDSBar.ScrollBarSelector;this.rsd=this.components.RangeSelectorDisplay=e.BackAnDisplay.RangeSelectorDisplay;this.rsdl=this.components.RangeSelectorLeft=this.rsd.RangeSelectorLeft;this.rsdr=this.components.RangeSelectorRight=this.rsd.RangeSelectorRight;this.rsdb=this.components.RangeSelectorBar=this.rsd.RangeSelectorBar;this.rsdbl=this.components.RangeSelectorBarL=this.rsdb.RangeSelectorBarL;this.rsdbr=this.components.RangeSelectorBarR=this.rsdb.RangeSelectorBarR;this.rs=c.rangeslider;this.editing=false;this.BigNewAn.hide()},newan:function(i,c){var d=this.player,h=this.annotator,g=10,e=d.currentTime(),f=this._sumPercent(e,g);var i=typeof i!="undefined"?i:e,c=typeof c!="undefined"?c:f;this._reset();d.showSlider();d.pause();d.setValueSlider(i,c);h.editor.VideoJS=this.player.id_;h.adder.show();this._setOverRS(h.adder);h.onAdderClick()},showDisplay:function(){this._reset();this.BackAnDisplay.removeClass("disable");this.BackAnDisplayScroll.removeClass("disable");videojs.addClass(this.ShowAn.el_,"active");this.options.showDisplay=true},hideDisplay:function(){this.BackAnDisplay.addClass("disable");this.BackAnDisplayScroll.addClass("disable");videojs.removeClass(this.ShowAn.el_,"active");this.options.showDisplay=false},showAnnotation:function(c){var h=this._isVideoJS(c);if(h){var i=c.rangeTime.start,d=c.rangeTime.end;this._reset();this.rs.show();this.rs.setValues(i,d);this.rs.lock();this.rs.playBetween(i,d);var g=this.rs.bar.el_,e=$(this.rs.left.el_).parent()[0];$(e).append('<span class="annotator-hl"></div>');$(g).appendTo($(e).find(".annotator-hl"));var f=$(g).parent()[0];$.data(f,"annotation",c);this._setOverRS(this.annotator.editor.element);this.annotator.editor.checkOrientation();this.rs.hidePanel()}},hideAnnotation:function(){this.rs.hide();this.rs.showPanel();var d=this.rs.bar.el_,c=$(this.rs.left.el_).parent()[0];if($(c).find(".annotator-hl").length>0){$(d).appendTo(c);$(c).find(".annotator-hl").remove()}},editAnnotation:function(c,e){if(this._isVideoJS(c)){this.hideDisplay();var d=this.player,e=e||this.annotator.editor;d.showSlider();d.unlockSlider();d.setValueSlider(c.rangeTime.start,c.rangeTime.end);d.showSliderPanel();this._setOverRS(e.element);e.checkOrientation();this.annotator.editor.VideoJS=d.id_}},refreshDisplay:function(){console.log("loadingAnnotations");var h=0,j=this.player.allannotations;this._sortByDate(j);$(this.AnDisplay.el_).find("span").remove();$(this.player.el_).find(".vjs-anpanel-annotation .annotation").remove();for(var k in j){var g=j[k];if(this._isVideoJS(g)){var c=document.createElement("div"),i=document.createElement("span"),e=this.rs._percent(g.rangeTime.start)*100,f=this.rs._percent(g.rangeTime.end)*100,d;i.appendChild(c);i.className="annotator-hl";d=Math.min(100,Math.max(0,f-e));c.className="annotation";c.id=h;c.style.top=h+"em";c.style.left=e+"%";c.style.width=d+"%";c.start=g.rangeTime.start;c.end=g.rangeTime.end;this.AnDisplay.el_.appendChild(i);$.data(i,"annotation",g);g.highlights=$(i);h++}}console.log(this.AnDisplay.el_);var e=this.rs._seconds(parseFloat(this.rsdl.el_.style.left)/100),f=this.rs._seconds(parseFloat(this.rsdr.el_.style.left)/100);this.showBetween(e,f,this.rsdl.include,this.rsdr.include)},showBetween:function(c,h,d,f){var g=this.player.duration(),c=c||0,h=h||g,n=$.makeArray($(this.player.el_).find(".vjs-anpanel-annotation .annotator-hl")),k=0;for(var l in n){var i=$.data(n[l],"annotation"),m=d?(i.rangeTime.end>=c):(i.rangeTime.start>=c),e=f?(i.rangeTime.start<=h):(i.rangeTime.end<=h);if(this._isVideoJS(i)&&m&&e&&typeof i.highlights[0]!="undefined"){var j=i.highlights[0].children[0];j.style.marginTop=(-1*parseFloat(j.style.top)+k)+"em";$(i.highlights[0]).show();k++}else{if(this._isVideoJS(i)&&typeof i.highlights[0]!="undefined"){$(i.highlights[0]).hide();i.highlights[0].children[0].style.marginTop=""}}}},setposBigNew:function(d){var d=d||"ul",c=this.player.BigNewAnnotation.el_;videojs.removeClass(c,"ul");videojs.removeClass(c,"ur");videojs.removeClass(c,"c");videojs.removeClass(c,"bl");videojs.removeClass(c,"br");videojs.addClass(c,d)},pressedKey:function(e){var d=this.player,c=this.player.rs;if(typeof e!="undefined"&&e==73){this._reset();this.rs.show();this.rs._reset();this.rs.setValue(0,d.currentTime());this.rs.right.el_.style.visibility="hidden";this.rs.tpr.el_.style.visibility="hidden";this.rs.ctpr.el_.style.visibility="hidden";this.rs.bar.el_.style.visibility="hidden";this.lastStartbyKey=d.currentTime()}else{if(typeof e!="undefined"&&e==79){if(this.rs.bar.el_.style.visibility=="hidden"){var f=this.lastStartbyKey!="undefined"?this.lastStartbyKey:0;this.newan(f,d.currentTime())}else{this.newan(d.currentTime(),d.currentTime())}}}},_reset:function(){this.hideDisplay();this.hideAnnotation();this.player.annotator.adder.hide();this.player.annotator.editor.hide();this.player.annotator.viewer.hide();this.rs.right.el_.style.visibility="";this.rs.tpr.el_.style.visibility="";this.rs.ctpr.el_.style.visibility="";this.rs.bar.el_.style.visibility="";this.rs.unlock();var c=this.player.duration();this.rsd.setPosition(0,0);this.rsd.setPosition(1,this.rs._percent(c));this.rs.bar.suspendPlay()},_setOverRS:function(g){var i=this.player.annotator,h=$(".annotator-wrapper")[0],c=videojs.findPosition(this.rs.left.el_),f=videojs.findPosition(this.rs.right.el_),e=videojs.findPosition(h),d={};g[0].style.display="block";d.left=c.left+(f.left-c.left)/2-e.left;d.top=c.top-e.top;g.css(d)},_onMouseDownRS:function(c){c.preventDefault();if(!this.rs.options.locked){videojs.on(document,"mousemove",videojs.bind(this,this._onMouseMoveRS));videojs.on(document,"mouseup",videojs.bind(this,this._onMouseUpRS))}},_onMouseMoveRS:function(e){var d=this.player,f=d.annotator,c=d.rangeslider;f.editor.element[0].style.display="none";c.show();this._setOverRS(f.adder)},_onMouseUpRS:function(e){videojs.off(document,"mousemove",this._onMouseMoveRS,false);videojs.off(document,"mouseup",this._onMouseUpRS,false);var d=this.player,f=d.annotator,c=d.rangeslider;f.editor.element[0].style.display="block";this._setOverRS(f.editor.element)},_sumPercent:function(e,c){var d=this.player.duration();var e=e||0;var c=c||10;c=Math.min(100,Math.max(0,c));if(isNaN(d)){return 0}return Math.min(d,Math.max(0,e+d*c/100))},_EditVideoAn:function(){var e=this.annotator,d=(typeof this.player!="undefined"),c=e.editor.VideoJS;return(d&&typeof c!="undefined"&&c!==-1)},_isVideoJS:function(i){var l=this.player,e=l.annotator,g=i.rangeTime,k=(typeof this.player!="undefined"),c=(typeof i.media!="undefined"&&i.media=="video"),d=(typeof i.target!="undefined"&&i.target.container==l.id_),m=(typeof g!="undefined"&&!isNaN(parseFloat(g.start))&&isFinite(g.start)&&!isNaN(parseFloat(g.end))&&isFinite(g.end)),j=false;if(d){var f=i.target.src.substring(0,i.target.src.lastIndexOf(".")),h=l.options_.sources[0].src.substring(0,l.options_.sources[0].src.lastIndexOf("."));j=(f==h)}return(k&&c&&d&&j&&m)},_sortByDate:function(d,c){var c=c||"asc";d.sort(function(f,e){f=new Date(typeof f.updated!="undefined"?createDateFromISO8601(f.updated):"");e=new Date(typeof e.updated!="undefined"?createDateFromISO8601(e.updated):"");if(c=="asc"){return e<f?-1:e>f?1:0}else{return f<e?-1:f>e?1:0}})}};videojs.ControlBar.prototype.options_.children.ShowAnnotations={};videojs.ControlBar.prototype.options_.children.NewAnnotation={};videojs.ControlBar.prototype.options_.children.BackAnDisplay={};videojs.ControlBar.prototype.options_.children.BackAnDisplayScroll={};videojs.options.children.BigNewAnnotation={};videojs.BigNewAnnotation=videojs.Button.extend({init:function(d,c){videojs.Button.call(this,d,c)}});videojs.BigNewAnnotation.prototype.init_=function(){this.an=this.player_.annotations};videojs.BigNewAnnotation.prototype.createEl=function(){return videojs.Button.prototype.createEl.call(this,"div",{className:"vjs-big-new-annotation vjs-menu-button vjs-control",innerHTML:'<div class="vjs-big-menu-button vjs-control">A</div>'})};videojs.BigNewAnnotation.prototype.onClick=function(){this.an.newan()};videojs.ShowAnnotations=videojs.Button.extend({init:function(d,c){videojs.Button.call(this,d,c)}});videojs.ShowAnnotations.prototype.init_=function(){this.an=this.player_.annotations};videojs.ShowAnnotations.prototype.createEl=function(){return videojs.Button.prototype.createEl.call(this,"div",{className:"vjs-showannotations-annotation vjs-menu-button vjs-control",innerHTML:'<div class="vjs-menu-button vjs-control">S</div>'})};videojs.ShowAnnotations.prototype.onClick=function(){if(!this.an.options.showDisplay){this.an.showDisplay()}else{this.an.hideDisplay()}};videojs.NewAnnotation=videojs.Button.extend({init:function(d,c){videojs.Button.call(this,d,c)}});videojs.NewAnnotation.prototype.init_=function(){this.an=this.player_.annotations};videojs.NewAnnotation.prototype.createEl=function(){return videojs.Button.prototype.createEl.call(this,"div",{className:"vjs-new-annotation vjs-menu-button vjs-control",})};videojs.NewAnnotation.prototype.onClick=function(){this.an.newan()};videojs.BackAnDisplay=videojs.Component.extend({init:function(d,c){videojs.Component.call(this,d,c)}});videojs.BackAnDisplay.prototype.init_=function(){this.an=this.player_.annotations;self=this;$(this.el_).watch("font-size",function(){self.an.backDSBarSel.setPosition(self.an.BackAnDisplayScroll.currentValue,false)})};videojs.BackAnDisplay.prototype.options_={children:{RangeSelectorDisplay:{},AnDisplay:{},}};videojs.BackAnDisplay.prototype.createEl=function(){return videojs.Component.prototype.createEl.call(this,"div",{className:"vjs-back-anpanel-annotation",})};videojs.RangeSelectorDisplay=videojs.Component.extend({init:function(d,c){videojs.Component.call(this,d,c);this.on("mousedown",this.onMouseDown)}});videojs.RangeSelectorDisplay.prototype.init_=function(){this.rs=this.player_.rangeslider;this.an=this.player_.annotations;this.start=0;this.end=this.an.player.duration()};videojs.RangeSelectorDisplay.prototype.options_={children:{RangeSelectorLeft:{},RangeSelectorRight:{},RangeSelectorBar:{},}};videojs.RangeSelectorDisplay.prototype.createEl=function(){return videojs.Component.prototype.createEl.call(this,"div",{className:"vjs-rangeselector-anpanel-annotation",})};videojs.RangeSelectorDisplay.prototype.onMouseDown=function(c){c.preventDefault();videojs.on(document,"mousemove",videojs.bind(this,this.onMouseMove));videojs.on(document,"mouseup",videojs.bind(this,this.onMouseUp));videojs.removeClass(this.an.rsdb.el_,"disable")};videojs.RangeSelectorDisplay.prototype.onMouseUp=function(c){videojs.off(document,"mousemove",this.onMouseMove,false);videojs.off(document,"mouseup",this.onMouseUp,false);videojs.addClass(this.an.rsdb.el_,"disable")};videojs.RangeSelectorDisplay.prototype.onMouseMove=function(c){var d=this.calculateDistance(c);if(this.an.rsdl.pressed){this.setPosition(0,d)}else{if(this.an.rsdr.pressed){this.setPosition(1,d)}}};videojs.RangeSelectorDisplay.prototype.calculateDistance=function(e){var c=this.getRSTBX();var d=this.getRSTBWidth();var f=this.getWidth();c=c+(f/2);d=d-f;return Math.max(0,Math.min(1,(e.pageX-c)/d))};videojs.RangeSelectorDisplay.prototype.getRSTBWidth=function(){return this.el_.offsetWidth};videojs.RangeSelectorDisplay.prototype.getRSTBX=function(){return videojs.findPosition(this.el_).left};videojs.RangeSelectorDisplay.prototype.getWidth=function(){var c=$(this.an.rsdl.el_).find(".vjs-selector-arrow")[0];return c.offsetWidth};videojs.RangeSelectorDisplay.prototype.setPosition=function(k,f){var k=k||0;if(isNaN(f)){return false}if(!(k===0||k===1)){return false}var i=this.an.rsdl.el_,g=this.an.rsdr.el_,j=this.an[k===0?"rsdl":"rsdr"].el_;if((k===0?this.updateLeft(f):this.updateRight(f))){if(k===1){j.style.left=(f*100)+"%";j.style.width=((1-f)*100)+"%"}else{j.style.left=(f*100)+"%";j.style.width=((f)*100)+"%"}this[k===0?"start":"end"]=this.rs._seconds(f);if(k===0&&(f*100)>=90){$(i).find(".vjs-selector-arrow")[0].style.zIndex=25}else{$(i).find(".vjs-selector-arrow")[0].style.zIndex=10}var c=this.an.rsdbl.el_,l=this.an.rsdbr.el_,d=parseFloat(g.style.left)-parseFloat(i.style.left);if(k===0){c.children[0].innerHTML=videojs.formatTime(this.rs._seconds(f))}else{l.children[0].innerHTML=videojs.formatTime(this.rs._seconds(f))}if(typeof d!="undefined"&&d<=12.5){if(parseFloat(i.style.left)<7){c.style.top=(-1.5)+"em";c.style.left=1+"em"}else{c.style.left=(-2.5)+"em";c.style.top=""}if(parseFloat(g.style.left)>93){l.style.top=(-1.5)+"em";l.style.right=1+"em"}else{l.style.right=(-2.5)+"em";l.style.top=""}}else{c.style.left=1+"em";l.style.right=1+"em";c.style.top="";l.style.top=""}var e=this.rs._seconds(parseFloat(i.style.left)/100),h=this.rs._seconds(parseFloat(g.style.left)/100);this.an.showBetween(e,h,this.an.rsdl.include,this.an.rsdr.include)}return true};videojs.RangeSelectorDisplay.prototype.updateLeft=function(g){var e=this.an.rsdr.el_.style.left!=""?this.an.rsdr.el_.style.left:100;var c=parseFloat(e)/100,f=this.an.rsdb.el_;var d=videojs.round((c-g),this.an.updatePrecision);if(g<=(c+0.00001)){f.style.left=(g*100)+"%";f.style.width=(d*100)+"%";return true}return false};videojs.RangeSelectorDisplay.prototype.updateRight=function(d){var c=this.an.rsdl.el_.style.left!=""?this.an.rsdl.el_.style.left:0;var g=parseFloat(c)/100,f=this.an.rsdb.el_;var e=videojs.round((d-g),this.an.updatePrecision);if((d+0.00001)>=g){f.style.width=(e*100)+"%";f.style.left=((d-e)*100)+"%";return true}return false};videojs.RangeSelectorLeft=videojs.Component.extend({init:function(d,c){videojs.Component.call(this,d,c);this.on("mousedown",this.onMouseDown);this.on("dblclick",this.ondblclick);this.pressed=false;this.include=true}});videojs.RangeSelectorLeft.prototype.init_=function(){this.rs=this.player_.rangeslider;this.an=this.player_.annotations;videojs.addClass(this.el_,"include")};videojs.RangeSelectorLeft.prototype.createEl=function(){return videojs.Component.prototype.createEl.call(this,"div",{className:"vjs-leftselector-anpanel-annotation",innerHTML:'<div class="vjs-selector-arrow"></div><div class="vjs-leftselector-back"></div>'})};videojs.RangeSelectorLeft.prototype.onMouseDown=function(c){c.preventDefault();this.pressed=true;videojs.on(document,"mouseup",videojs.bind(this,this.onMouseUp));videojs.addClass(this.el_,"active");videojs.addClass(this.el_.parentNode,"active")};videojs.RangeSelectorLeft.prototype.onMouseUp=function(c){videojs.off(document,"mouseup",this.onMouseUp,false);videojs.removeClass(this.el_,"active");videojs.removeClass(this.el_.parentNode,"active");this.pressed=false};videojs.RangeSelectorLeft.prototype.ondblclick=function(c){if(this.include){this.include=false;videojs.removeClass(this.el_,"include")}else{this.include=true;videojs.addClass(this.el_,"include")}var d=this.an.rsd.calculateDistance(c);this.an.rsd.setPosition(0,d)};videojs.RangeSelectorRight=videojs.Component.extend({init:function(d,c){videojs.Component.call(this,d,c);this.on("mousedown",this.onMouseDown);this.on("dblclick",this.ondblclick);this.pressed=false;this.include=true}});videojs.RangeSelectorRight.prototype.init_=function(){this.rs=this.player_.rangeslider;this.an=this.player_.annotations;videojs.addClass(this.el_,"include")};videojs.RangeSelectorRight.prototype.createEl=function(){return videojs.Component.prototype.createEl.call(this,"div",{className:"vjs-rightselector-anpanel-annotation",innerHTML:'<div class="vjs-selector-arrow"></div><div class="vjs-rightselector-back"></div>'})};videojs.RangeSelectorRight.prototype.onMouseDown=function(c){c.preventDefault();this.pressed=true;videojs.on(document,"mouseup",videojs.bind(this,this.onMouseUp));videojs.addClass(this.el_,"active");videojs.addClass(this.el_.parentNode,"active")};videojs.RangeSelectorRight.prototype.onMouseUp=function(c){videojs.off(document,"mouseup",this.onMouseUp,false);videojs.removeClass(this.el_,"active");videojs.removeClass(this.el_.parentNode,"active");this.pressed=false};videojs.RangeSelectorRight.prototype.ondblclick=function(c){if(this.include){this.include=false;videojs.removeClass(this.el_,"include")}else{this.include=true;videojs.addClass(this.el_,"include")}var d=this.an.rsd.calculateDistance(c);this.an.rsd.setPosition(1,d)};videojs.RangeSelectorBar=videojs.Component.extend({init:function(d,c){videojs.Component.call(this,d,c)}});videojs.RangeSelectorBar.prototype.init_=function(){videojs.addClass(this.el_,"disable")};videojs.RangeSelectorBar.prototype.options_={children:{RangeSelectorBarL:{},RangeSelectorBarR:{},}};videojs.RangeSelectorBar.prototype.createEl=function(){return videojs.Component.prototype.createEl.call(this,"div",{className:"vjs-barselector-anpanel-annotation",})};videojs.RangeSelectorBarL=videojs.Component.extend({init:function(d,c){videojs.Component.call(this,d,c)}});videojs.RangeSelectorBarL.prototype.init_=function(){};videojs.RangeSelectorBarL.prototype.createEl=function(){return videojs.Component.prototype.createEl.call(this,"div",{className:"vjs-barselector-left",innerHTML:'<span class="vjs-time-text">00:00</span>'})};videojs.RangeSelectorBarR=videojs.Component.extend({init:function(d,c){videojs.Component.call(this,d,c)}});videojs.RangeSelectorBarR.prototype.init_=function(){};videojs.RangeSelectorBarR.prototype.createEl=function(){return videojs.Component.prototype.createEl.call(this,"div",{className:"vjs-barselector-right",innerHTML:'<span class="vjs-time-text">00:00</span>'})};videojs.AnDisplay=videojs.Component.extend({init:function(d,c){videojs.Component.call(this,d,c);this.on("mousedown",this.onMouseDown);this.on("mouseover",this.onMouseOver)}});videojs.AnDisplay.prototype.init_=function(){this.rs=this.player_.rangeslider;this.an=this.player_.annotations;this.transition=false};videojs.AnDisplay.prototype.createEl=function(){return videojs.Component.prototype.createEl.call(this,"div",{className:"vjs-anpanel-annotation",})};videojs.AnDisplay.prototype.onMouseDown=function(h){var g=$(h.target).parents(".annotator-hl").andSelf(),d=this;if(g.hasClass("annotator-hl")){videojs.on(document,"mouseup",videojs.bind(this,this.onMouseUp));var f=document.createElement("div"),i=parseFloat(g[1].style.top),e=parseFloat(g[1].style.marginTop),c=parseFloat($(g[1]).css("height"));f.className="boxup-dashed-line";f.style.left=g[1].style.left;f.style.width=g[1].style.width;f.style.top=(i+e-this.el_.scrollTop/c)+"em";g[0].parentNode.parentNode.appendChild(f)}};videojs.AnDisplay.prototype.onMouseUp=function(h){if(typeof this.lastelem=="undefined"){return false}var g=this.lastelem,e=this;if(g.hasClass("annotator-hl")){var d=g.map(function(){return $(this).data("annotation")})[0];var f=(-1)*parseFloat($(this.el_).parent()[0].style.top),c=parseFloat($(g[1]).css("height"));if(typeof $(g).parent().parent().find(".boxup-dashed-line")[0]!="undefined"){$(g).parent().parent().find(".boxup-dashed-line")[0].style.top=(f-2)+"em"}this.an.player.pause();this.transition=true;window.setTimeout(function(){e.an.showAnnotation(d);e.transition=false;e.onCloseViewer()},900)}videojs.off(document,"mouseup",this.onMouseUp,false)};videojs.AnDisplay.prototype.onMouseOver=function(f){if(!this.transition&&!this.an.rsdl.pressed&&!this.an.rsdr.pressed){var j=this.an.annotator;var e=$(f.target).parents(".annotator-hl").andSelf();if(typeof j!="undefined"&&j.viewer.isShown()&&e.hasClass("annotator-hl")){j.viewer.hide();var h=e.map(function(){return $(this).data("annotation")});j.showViewer($.makeArray(h),Util.mousePosition(f,j.wrapper[0]))}e.addClass("active");if(typeof e!="undefined"&&$(e[1]).hasClass("annotation")){var d=document.createElement("div"),g=document.createElement("div"),i=parseFloat(this.an.BackAnDisplay.el_.style.height),c=e[1].style.marginTop!=""?parseFloat(e[1].style.marginTop):0;ElemTop=parseFloat(e[1].style.top)+c,emtoPx=parseFloat($(e[1]).css("height"));d.className="dashed-line";g.className="box-dashed-line";d.style.left=g.style.left=e[1].style.left;d.style.width=g.style.width=e[1].style.width;d.style.top=((ElemTop+1)-this.el_.scrollTop/emtoPx)+"em";d.style.height=((i-ElemTop+1)+this.el_.scrollTop/emtoPx)+"em";g.style.top=(i+1)+"em";e[0].parentNode.parentNode.appendChild(d);e[0].parentNode.parentNode.appendChild(g);$(this.player).find(".vjs-play-progress").css("z-index",2);$(this.player).find(".vjs-seek-handle").css("z-index",2)}if(e.hasClass("annotator-hl")){this.lastelem=e}}};videojs.AnDisplay.prototype.onCloseViewer=function(){if(!this.transition){if(typeof this.lastelem!="undefined"){this.lastelem.removeClass("active")}if(typeof this.lastelem!="undefined"&&this.lastelem.hasClass("annotator-hl")){$(this.lastelem).parent().parent().find(".dashed-line").remove();$(this.lastelem).parent().parent().find(".box-dashed-line").remove();$(this.lastelem).parent().parent().find(".boxup-dashed-line").remove();$(this.player).find(".vjs-play-progress").css("z-index","");$(this.player).find(".vjs-seek-handle").css("z-index","")}}};videojs.BackAnDisplayScroll=videojs.Component.extend({init:function(d,c){videojs.Component.call(this,d,c);this.on("mousedown",this.onMouseDown);this.UpValue=0.1;this.currentValue=0}});videojs.BackAnDisplayScroll.prototype.init_=function(){this.rs=this.player_.rangeslider;this.an=this.player_.annotations;this.mousedownID=-1;var c=this,d;$(this.an.AnDisplay.el_).bind("DOMMouseScroll",function(f){if(f.originalEvent.detail>0){d=c.UpValue}else{d=-c.UpValue}c.an.backDSBarSel.setPosition(c.getPercentScroll()+d);return false});$(this.an.AnDisplay.el_).bind("mousewheel",function(f){if(f.originalEvent.wheelDelta<0){d=c.UpValue}else{d=-c.UpValue}c.an.backDSBarSel.setPosition(c.getPercentScroll()+d);return false})};videojs.BackAnDisplayScroll.prototype.options_={children:{BackAnDisplayScrollBar:{},}};videojs.BackAnDisplayScroll.prototype.createEl=function(){return videojs.Component.prototype.createEl.call(this,"div",{className:"vjs-scroll-anpanel-annotation",innerHTML:'<div class="vjs-up-scroll-annotation"></div><div class="vjs-down-scroll-annotation"></div>',})};videojs.BackAnDisplayScroll.prototype.onMouseDown=function(d){var c=this;if(d.target.className=="vjs-scrollbar-anpanel-annotation"){this.an.backDSBarSel.onMouseMove(d);return false}else{if(d.target.className=="vjs-scrollbar-selector"){return false}else{var e=d.target.className=="vjs-down-scroll-annotation"?this.UpValue:-this.UpValue;videojs.on(document,"mouseup",videojs.bind(this,this.onMouseUp));if(this.mousedownID==-1){this.mousedownID=setInterval(function(){c.an.backDSBarSel.setPosition(c.getPercentScroll()+e)},100)}}}};videojs.BackAnDisplayScroll.prototype.onMouseUp=function(d){videojs.off(document,"mouseup",this.onMouseUp,false);var c=this;if(this.mousedownID!=-1){clearInterval(this.mousedownID);c.mousedownID=-1}};videojs.BackAnDisplayScroll.prototype.getPercentScroll=function(){var c=this.an.AnDisplay.el_,e=c.scrollHeight-c.offsetHeight,d=c.scrollTop;return Math.max(0,Math.min(1,e!=0?(d/e):0))};videojs.BackAnDisplayScroll.prototype.setPercentScroll=function(d){var c=this.an.AnDisplay.el_,e=c.scrollHeight-c.offsetHeight;d=Math.max(0,Math.min(1,d?d:0));c.scrollTop=(e*d)};videojs.BackAnDisplayScrollBar=videojs.Component.extend({init:function(d,c){videojs.Component.call(this,d,c)}});videojs.BackAnDisplayScrollBar.prototype.init_=function(){this.rs=this.player_.rangeslider;this.an=this.player_.annotations};videojs.BackAnDisplayScrollBar.prototype.options_={children:{ScrollBarSelector:{},}};videojs.BackAnDisplayScrollBar.prototype.createEl=function(){return videojs.Component.prototype.createEl.call(this,"div",{className:"vjs-scrollbar-anpanel-annotation",})};videojs.ScrollBarSelector=videojs.Component.extend({init:function(d,c){videojs.Component.call(this,d,c);this.on("mousedown",this.onMouseDown)}});videojs.ScrollBarSelector.prototype.init_=function(){this.rs=this.player_.rangeslider;this.an=this.player_.annotations;videojs.addClass(this.an.backDSBar.el_,"disable")};videojs.ScrollBarSelector.prototype.createEl=function(){return videojs.Component.prototype.createEl.call(this,"div",{className:"vjs-scrollbar-selector",})};videojs.ScrollBarSelector.prototype.onMouseDown=function(c){c.preventDefault();videojs.on(document,"mousemove",videojs.bind(this,this.onMouseMove));videojs.on(document,"mouseup",videojs.bind(this,this.onMouseUp))};videojs.ScrollBarSelector.prototype.onMouseUp=function(c){videojs.off(document,"mousemove",this.onMouseMove,false);videojs.off(document,"mouseup",this.onMouseUp,false)};videojs.ScrollBarSelector.prototype.onMouseMove=function(c){var d=this.calculateDistance(c);d=this.parseMaxPercent(d);this.setPosition(d)};videojs.ScrollBarSelector.prototype.calculateDistance=function(e){var f=this.getscrollY();var d=this.getscrollHeight();var c=this.getHeight();f=f+(c);d=d-(c);return Math.max(0,Math.min(1,(e.pageY-f)/d))};videojs.ScrollBarSelector.prototype.getscrollHeight=function(){return this.el_.parentNode.offsetHeight};videojs.ScrollBarSelector.prototype.getscrollY=function(){return videojs.findPosition(this.el_.parentNode).top};videojs.ScrollBarSelector.prototype.getHeight=function(){return this.el_.offsetHeight};videojs.ScrollBarSelector.prototype.parseMaxHeight=function(f){var d=this.getscrollHeight(),c=this.getHeight(),e=c/d;return Math.max(0,Math.min(1-e,f))};videojs.ScrollBarSelector.prototype.parseMaxPercent=function(g){var e=this.getscrollHeight(),d=this.getHeight(),f=d/e,c=g;if(g>=(1-f)){c=1}return c};videojs.ScrollBarSelector.prototype.setPosition=function(g,f){var f=typeof f!="undefined"?f:true;if(isNaN(g)){return false}if(f){videojs.removeClass(this.an.backDSBar.el_,"disable")}var e=this.el_,d=this.an.BackAnDisplayScroll;e.style.top=(this.parseMaxHeight(g)*100)+"%";d.setPercentScroll(g);if(f){var c=this;if(typeof this.Timeout!="undefined"){clearTimeout(this.Timeout)}this.Timeout=window.setTimeout(function(){videojs.addClass(c.an.backDSBar.el_,"disable")},1000)}this.an.BackAnDisplayScroll.currentValue=g;return true}})();Annotator.Plugin.VideoJS=(function(b){__extends(a,b);function a(){this.pluginSubmit=__bind(this.pluginSubmit,this);this.updateField=__bind(this.updateField,this);_ref=a.__super__.constructor.apply(this,arguments);this.__indexOf=[].indexOf||function(e){for(var d=0,c=this.length;d<c;d++){if(d in this&&this[d]===e){return d}}return -1};return _ref}a.prototype.field=null;a.prototype.input=null;a.prototype.pluginInit=function(){console.log("VideoJS-pluginInit");if(!Annotator.supported()){return}this.field=this.annotator.editor.addField({id:"vjs-input-rangeTime-annotations",type:"input",submit:this.pluginSubmit,EditVideoAn:this.EditVideoAn});var c='<li><span id="vjs-input-rangeTime-annotations"></span></li>',d=Annotator.$(c);Annotator.$(this.field).replaceWith(d);this.field=d[0];this.annotator.viewer.addField({load:this.updateViewer});this.initListeners();return this.input=$(this.field).find(":input")};a.prototype.updateField=function(d,c){console.log("Plug-updateField")};a.prototype.pluginSubmit=function(i,c){console.log("Plug-pluginSubmit");if(this.EditVideoAn()){var e=this.annotator.editor.VideoJS,f=this.annotator.mplayer[e],d=f.rangeslider,h=d.getValues(),g;c.media="video";c.target=c.target||{};c.target.container=f.id_||"";console.log(f);c.target.src=f.options_.sources[0].src||"";g=(f.options_.sources[0].src.substring(f.options_.sources[0].src.lastIndexOf("."))).toLowerCase();c.target.ext=g||"";c.rangeTime=c.rangeTime||{};c.rangeTime.start=h.start||0;c.rangeTime.end=h.end||0;c.updated=new Date().toISOString();if(typeof c.created=="undefined"){c.created=new Date().toISOString()}}else{if(typeof c.media=="undefined"){c.media="text"}}return c.media};a.prototype.updateViewer=function(d,c){console.log("Plug-updateViewer")};a.prototype.EditVideoAn=function(){var f=$(".annotator-wrapper").parent()[0],e=window.annotator=$.data(f,"annotator"),d=(typeof e.mplayer!="undefined"),c=e.editor.VideoJS;return(d&&typeof c!="undefined"&&c!==-1)};a.prototype.isVideoJS=function(f){var i=$(".annotator-wrapper").parent()[0],h=window.annotator=$.data(i,"annotator"),c=f.rangeTime,e=(typeof h.mplayer!="undefined"),g=(typeof f.media!="undefined"&&f.media=="video"),d=(typeof c!="undefined"&&!isNaN(parseFloat(c.start))&&isFinite(c.start)&&!isNaN(parseFloat(c.end))&&isFinite(c.end));return(e&&g&&d)};a.prototype._deleteAnnotation=function(f){var h=f.target||{},c=h.container||{},i=this.annotator,e=i.mplayer[c],g=e.annotations,d;d=this.__indexOf.call(e.allannotations,f);if(d>=0){if(typeof e.allannotations[d]!="undefined"){delete e.allannotations[d]}e.rangeslider.hide();g.refreshDisplay()}};a.prototype.initListeners=function(){var g=$(".annotator-wrapper").parent()[0],f=$.data(g,"annotator");var e=this.EditVideoAn,d=this.isVideoJS,c=this;this.annotator.subscribe("annotationEditorShown",function(j,h){console.log("annotationEditorShown");for(var i in f.an){f.an[i].editAnnotation(h,j)}}).subscribe("annotationEditorHidden",function(i){console.log("annotationEditorHidden");if(e()){var h=f.editor.VideoJS;f.mplayer[h].rangeslider.hide();f.an[h].refreshDisplay()}f.editor.VideoJS=-1}).subscribe("annotationDeleted",function(h){console.log("annotationDeleted");if(d(h)){c._deleteAnnotation(h)}}).subscribe("annotationViewerShown",function(k,j){console.log("annotationViewerShown");var h=k.element.hasClass(k.classes.invert.y)?5:-5,i={top:parseFloat(k.element[0].style.top)+h,left:parseFloat(k.element[0].style.left)};k.element.css(i);k.element.find(".annotator-controls").removeClass(k.classes.showControls)});this.annotator.viewer.subscribe("hide",function(){for(var h in f.an){f.an[h].AnDisplay.onCloseViewer()}})};return a})(Annotator.Plugin);OpenVideoAnnotation=("OpenVideoAnnotation" in window)?OpenVideoAnnotation:{};OpenVideoAnnotation.Annotator=function(f,m){var e=jQuery,m=m||{};m.optionsAnnotator=m.optionsAnnotator||{};m.optionsVideoJS=m.optionsVideoJS||{};m.optionsRS=m.optionsRS||{};m.optionsOVA=m.optionsOVA||{};var j=m.optionsAnnotator.store;if(typeof j=="undefined"){m.optionsAnnotator.store={}}if(typeof j.annotationData=="undefined"){j.annotationData={}}if(typeof j.annotationData.uri=="undefined"){var b=location.protocol+"//"+location.host+location.pathname;j.annotationData.store={uri:b}}if(typeof j.loadFromSearch=="undefined"){j.loadFromSearch={}}if(typeof j.loadFromSearch.uri=="undefined"){j.loadFromSearch.uri=b}if(typeof j.loadFromSearch.limit=="undefined"){j.loadFromSearch.limit=10000}this.currentUser=null;this.annotator=e(f).annotator().data("annotator");var i=e(f).find("div .video-js").toArray();var l=this.mplayer={};for(var h in i){var a=i[h].id;var g=videojs(i[h],m.optionsVideoJS);this.mplayer[a]=g}this.annotator.an={};for(var h in this.mplayer){this.mplayer[h].rangeslider(e.extend(true,{},m.optionsRS));this.mplayer[h].annotations(e.extend(true,{},m.optionsOVA));this.annotator.an[h]=this.mplayer[h].annotations}this.setCurrentUser=function(n){this.currentUser=n;this.annotator.plugins.Permissions.setUser(n)};var d=this.focusedPlayer="",c=this.lastfocusPlayer="";function k(n){if(n.target.nodeName.toLowerCase()!="textarea"){l[d].annotations.pressedKey(n.which)}}(this._setupKeyboard=function(){e(document).mousedown(function(o){d="";for(var n in l){if(e(l[n].el_).find(o.target).length){d=l[n].id_}}if(c!=d){e(document).off("keyup",k);if(d!=""){e(document).on("keyup",k)}}c=d})})(this);this.annotator.addPlugin("Permissions",m.optionsAnnotator.user);this.annotator.addPlugin("Store",m.optionsAnnotator.store);this.annotator.addPlugin("Tags");this.annotator.addPlugin("Share");this.annotator.addPlugin("VideoJS");this.annotator.mplayer=this.mplayer;this.annotator.editor.VideoJS=-1;return this};OpenVideoAnnotation.Annotator.prototype.newVideoAn=function(a){return this.mplayer[a].annotations.newan()};OpenVideoAnnotation.Annotator.prototype.showDisplay=function(a){return this.mplayer[a].annotations.showDisplay()};OpenVideoAnnotation.Annotator.prototype.hideDisplay=function(a){return this.mplayer[a].annotations.hideDisplay()};OpenVideoAnnotation.Annotator.prototype.refreshDisplay=function(a){return this.mplayer[a].annotations.hideDisplay()};OpenVideoAnnotation.Annotator.prototype.setposBigNew=function(b,a){return this.mplayer[b].annotations.setposBigNew(a)};