var _ref,__bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(d,b){for(var a in b){if(__hasProp.call(b,a)){d[a]=b[a]}}function c(){this.constructor=d}c.prototype=b.prototype;d.prototype=new c();d.__super__=b.prototype;return d},createDateFromISO8601=function(b){var h,a,g,e,f,c;e="([0-9]{4})(-([0-9]{2})(-([0-9]{2})(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(\\.([0-9]+))?)?(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?";h=b.match(new RegExp(e));g=0;a=new Date(h[1],0,1);if(h[3]){a.setMonth(h[3]-1)}if(h[5]){a.setDate(h[5])}if(h[7]){a.setHours(h[7])}if(h[8]){a.setMinutes(h[8])}if(h[10]){a.setSeconds(h[10])}if(h[12]){a.setMilliseconds(Number("0."+h[12])*1000)}if(h[14]){g=(Number(h[16])*60)+Number(h[17]);g*=(c=h[15]==="-")!=null?c:{1:-1}}g-=a.getTimezoneOffset();f=Number(a)+(g*60*1000);a.setTime(Number(f));return a};var Util=typeof Util!="undefined"?Util:{};Util.mousePosition=function(b,d){var c,a;if((a=$(d).css("position"))!=="absolute"&&a!=="fixed"&&a!=="relative"){d=$(d).offsetParent()[0]}c=$(d).offset();return{top:b.pageY-c.top,left:b.pageX-c.left}};(function(){function b(c){var d=this;d.annotations=new a(d,c);function e(i){var h=d.annotations;for(var g in h.components){h.components[g].init_()}d.annotations.BigNewAn.show();var k=$(".annotator-wrapper").parent()[0],j=$.data(k,"annotator");h.setposBigNew(h.options.posBigNew);if(!c.showDisplay){h.hideDisplay()}h.BackAnDisplay.el_.style.height=(h.options.NumAnnotations+"em");h.BackAnDisplay.el_.style.top="-"+(h.options.NumAnnotations+2+"em");h.BackAnDisplayScroll.el_.children[0].style.top="-"+(h.options.NumAnnotations+4+"em");d.annotator=j;h.annotator=j;var f=j.plugins.Store.annotations;d.allannotations=f;h.refreshDisplay();console.log(f);d.rangeslider.rstb.on("mousedown",function(){h._onMouseDownRS(i)});if(this.autoPlayAPI){d.annotations.showAnnotation(this.autoPlayAPI,true);$("html,body").animate({scrollTop:$("#"+d.id_).offset().top},"slow")}}this.on("durationchange",e);console.log("Loaded Annotation Plugin")}videojs.plugin("annotations",b);function a(d,c){var d=d||this;this.player=d;this.components={};c=c||{};if(!c.hasOwnProperty("posBigNew")){c.posBigNew="ul"}if(!c.hasOwnProperty("showDisplay")){c.showDisplay=false}if(!c.hasOwnProperty("NumAnnotations")){c.NumAnnotations=16}this.options=c;this.init()}a.prototype={init:function(){var c=this.player||{},e=c.controlBar,d=c.controlBar.progressControl.seekBar;this.updatePrecision=3;this.NewAn=this.components.NewAnnotation=e.NewAnnotation;this.BigNewAn=this.components.BigNewAnnotation=c.BigNewAnnotation;this.ShowAn=this.components.ShowAnnotations=e.ShowAnnotations;this.BackAnDisplay=this.components.BackAnDisplay=e.BackAnDisplay;this.AnDisplay=this.components.AnDisplay=e.BackAnDisplay.AnDisplay;this.BackAnDisplayScroll=this.components.BackAnDisplayScroll=e.BackAnDisplayScroll;this.rsd=this.components.RangeSelectorDisplay=e.BackAnDisplay.RangeSelectorDisplay;this.rsdl=this.components.RangeSelectorLeft=this.rsd.RangeSelectorLeft;this.rsdr=this.components.RangeSelectorRight=this.rsd.RangeSelectorRight;this.rs=c.rangeslider;this.editing=false;this.BigNewAn.hide()},newan:function(i,c){var d=this.player,h=this.annotator,g=10,e=d.currentTime(),f=this._sumPercent(e,g);var i=typeof i!="undefined"?i:e,c=typeof c!="undefined"?c:f;this._reset();d.showSlider();d.pause();d.setValueSlider(i,c);h.editor.VideoJS=this.player.id_;h.adder.show();this._setOverRS(h.adder);h.onAdderClick()},showDisplay:function(){this._reset();this.BackAnDisplay.removeClass("disable");this.BackAnDisplayScroll.removeClass("disable");videojs.addClass(this.ShowAn.el_,"active");this.options.showDisplay=true},hideDisplay:function(){this.BackAnDisplay.addClass("disable");this.BackAnDisplayScroll.addClass("disable");videojs.removeClass(this.ShowAn.el_,"active");this.options.showDisplay=false},showAnnotation:function(c){var h=this._isVideoJS(c);if(h){var i=c.rangeTime.start,d=c.rangeTime.end;this._reset();this.rs.show();this.rs.setValues(i,d);this.rs.lock();this.rs.playBetween(i,d);var g=this.rs.bar.el_,e=$(this.rs.left.el_).parent()[0];$(e).append('<span class="annotator-hl"></div>');$(g).appendTo($(e).find(".annotator-hl"));var f=$(g).parent()[0];$.data(f,"annotation",c);this._setOverRS(this.annotator.editor.element);this.annotator.editor.checkOrientation();this.rs.hidePanel()}},hideAnnotation:function(){this.rs.hide();this.rs.showPanel();var d=this.rs.bar.el_,c=$(this.rs.left.el_).parent()[0];if($(c).find(".annotator-hl").length>0){$(d).appendTo(c);$(c).find(".annotator-hl").remove()}},editAnnotation:function(c,e){if(this._isVideoJS(c)){this.hideDisplay();var d=this.player,e=e||this.annotator.editor;d.showSlider();d.unlockSlider();d.setValueSlider(c.rangeTime.start,c.rangeTime.end);d.showSliderPanel();this._setOverRS(e.element);e.checkOrientation();this.annotator.editor.VideoJS=d.id_}},refreshDisplay:function(){console.log("loadingAnnotations");var h=0,j=this.player.allannotations;this._sortByDate(j);$(this.AnDisplay.el_).find("span").remove();$(this.player.el_).find(".vjs-anpanel-annotation .annotation").remove();for(var k in j){var g=j[k];if(this._isVideoJS(g)){var c=document.createElement("div"),i=document.createElement("span"),e=this.rs._percent(g.rangeTime.start)*100,f=this.rs._percent(g.rangeTime.end)*100,d;i.appendChild(c);i.className="annotator-hl";d=Math.min(100,Math.max(0,f-e));c.className="annotation";c.id=h;c.style.top=h+"em";c.style.left=e+"%";c.style.width=d+"%";c.start=g.rangeTime.start;c.end=g.rangeTime.end;this.AnDisplay.el_.appendChild(i);$.data(i,"annotation",g);g.highlights=$(i);h++}}},showBetween:function(j,d){var i=this.player.duration(),j=j||0,d=d||i,c=$.makeArray($(this.player.el_).find(".vjs-anpanel-annotation .annotator-hl")),h=0;for(var e in c){var g=$.data(c[e],"annotation");if(this._isVideoJS(g)&&g.rangeTime.end>=j&&g.rangeTime.start<=d&&typeof g.highlights[0]!="undefined"){var f=g.highlights[0].children[0];f.style.marginTop=(-1*parseFloat(f.style.top)+h)+"em";$(g.highlights[0]).show();h++}else{if(this._isVideoJS(g)&&typeof g.highlights[0]!="undefined"){$(g.highlights[0]).hide();g.highlights[0].children[0].style.marginTop=""}}}},setposBigNew:function(d){var d=d||"ul",c=this.player.BigNewAnnotation.el_;videojs.removeClass(c,"ul");videojs.removeClass(c,"ur");videojs.removeClass(c,"c");videojs.removeClass(c,"bl");videojs.removeClass(c,"br");videojs.addClass(c,d)},pressedKey:function(e){var d=this.player,c=this.player.rs;if(typeof e!="undefined"&&e==73){this._reset();this.rs.show();this.rs._reset();this.rs.setValue(0,d.currentTime());this.rs.right.el_.style.visibility="hidden";this.rs.tpr.el_.style.visibility="hidden";this.rs.ctpr.el_.style.visibility="hidden";this.rs.bar.el_.style.visibility="hidden";this.lastStartbyKey=d.currentTime()}else{if(typeof e!="undefined"&&e==79){if(this.rs.bar.el_.style.visibility=="hidden"){var f=this.lastStartbyKey!="undefined"?this.lastStartbyKey:0;this.newan(f,d.currentTime())}else{this.newan(d.currentTime(),d.currentTime())}}}},_reset:function(){this.hideDisplay();this.hideAnnotation();this.player.annotator.adder.hide();this.player.annotator.editor.hide();this.player.annotator.viewer.hide();this.rs.right.el_.style.visibility="";this.rs.tpr.el_.style.visibility="";this.rs.ctpr.el_.style.visibility="";this.rs.bar.el_.style.visibility="";this.rs.unlock();var c=this.player.duration();this.rsd.setPosition(0,0);this.rsd.setPosition(1,this.rs._percent(c));this.rs.bar.suspendPlay()},_setOverRS:function(g){var i=this.player.annotator,h=$(".annotator-wrapper")[0],c=videojs.findPosition(this.rs.left.el_),f=videojs.findPosition(this.rs.right.el_),e=videojs.findPosition(h),d={};g[0].style.display="block";d.left=c.left+(f.left-c.left)/2-e.left;d.top=c.top-e.top;g.css(d)},_onMouseDownRS:function(c){c.preventDefault();videojs.blockTextSelection();if(!this.rs.options.locked){videojs.on(document,"mousemove",videojs.bind(this,this._onMouseMoveRS));videojs.on(document,"mouseup",videojs.bind(this,this._onMouseUpRS))}},_onMouseMoveRS:function(e){var d=this.player,f=d.annotator,c=d.rangeslider;f.editor.element[0].style.display="none";c.show();this._setOverRS(f.adder)},_onMouseUpRS:function(e){videojs.off(document,"mousemove",this._onMouseMoveRS,false);videojs.off(document,"mouseup",this._onMouseUpRS,false);var d=this.player,f=d.annotator,c=d.rangeslider;f.editor.element[0].style.display="block";this._setOverRS(f.editor.element)},_sumPercent:function(e,c){var d=this.player.duration();var e=e||0;var c=c||10;c=Math.min(100,Math.max(0,c));if(isNaN(d)){return 0}return Math.min(d,Math.max(0,e+d*c/100))},_EditVideoAn:function(){var e=this.annotator,d=(typeof this.player!="undefined"),c=e.editor.VideoJS;return(d&&typeof c!="undefined"&&c!==-1)},_isVideoJS:function(i){var l=this.player,e=l.annotator,g=i.rangeTime,k=(typeof this.player!="undefined"),c=(typeof i.media!="undefined"&&i.media=="video"),d=(typeof i.target!="undefined"&&i.target.container==l.id_),m=(typeof g!="undefined"&&!isNaN(parseFloat(g.start))&&isFinite(g.start)&&!isNaN(parseFloat(g.end))&&isFinite(g.end)),j=false;if(d){var f=i.target.src.substring(0,i.target.src.lastIndexOf(".")),h=l.tag.currentSrc.substring(0,l.tag.currentSrc.lastIndexOf("."));j=(f==h)}return(k&&c&&d&&j&&m)},_sortByDate:function(d,c){var c=c||"asc";d.sort(function(f,e){f=new Date(createDateFromISO8601(f.updated));e=new Date(createDateFromISO8601(e.updated));if(c=="asc"){return e<f?-1:e>f?1:0}else{return f<e?-1:f>e?1:0}})}};videojs.ControlBar.prototype.options_.children.ShowAnnotations={};videojs.ControlBar.prototype.options_.children.NewAnnotation={};videojs.ControlBar.prototype.options_.children.BackAnDisplay={};videojs.ControlBar.prototype.options_.children.BackAnDisplayScroll={};videojs.options.children.BigNewAnnotation={};videojs.NewAnnotation=videojs.Button.extend({init:function(d,c){videojs.Button.call(this,d,c)}});videojs.NewAnnotation.prototype.init_=function(){this.rs=this.player_.rangeslider;this.an=this.player_.annotations};videojs.NewAnnotation.prototype.createEl=function(){return videojs.Button.prototype.createEl.call(this,"div",{className:"vjs-new-annotation vjs-menu-button vjs-control",})};videojs.NewAnnotation.prototype.onClick=function(){this.an.newan()};videojs.BigNewAnnotation=videojs.Button.extend({init:function(d,c){videojs.Button.call(this,d,c)}});videojs.BigNewAnnotation.prototype.init_=function(){this.rs=this.player_.rangeslider;this.an=this.player_.annotations};videojs.BigNewAnnotation.prototype.createEl=function(){return videojs.Button.prototype.createEl.call(this,"div",{className:"vjs-big-new-annotation vjs-menu-button vjs-control",innerHTML:'<div class="vjs-big-menu-button vjs-control">A</div>'})};videojs.BigNewAnnotation.prototype.onClick=function(){this.an.newan()};videojs.ShowAnnotations=videojs.Button.extend({init:function(d,c){videojs.Button.call(this,d,c)}});videojs.ShowAnnotations.prototype.init_=function(){this.rs=this.player_.rangeslider;this.an=this.player_.annotations};videojs.ShowAnnotations.prototype.createEl=function(){return videojs.Button.prototype.createEl.call(this,"div",{className:"vjs-showannotations-annotation vjs-menu-button vjs-control",innerHTML:'<div class="vjs-menu-button vjs-control">S</div>'})};videojs.ShowAnnotations.prototype.onClick=function(){if(!this.an.options.showDisplay){this.an.showDisplay()}else{this.an.hideDisplay()}};videojs.BackAnDisplay=videojs.Component.extend({init:function(d,c){videojs.Component.call(this,d,c)}});videojs.BackAnDisplay.prototype.init_=function(){this.rs=this.player_.rangeslider;this.an=this.player_.annotations};videojs.BackAnDisplay.prototype.options_={children:{RangeSelectorDisplay:{},AnDisplay:{},}};videojs.BackAnDisplay.prototype.createEl=function(){return videojs.Component.prototype.createEl.call(this,"div",{className:"vjs-back-anpanel-annotation",})};videojs.RangeSelectorDisplay=videojs.Component.extend({init:function(d,c){videojs.Component.call(this,d,c);this.on("mousedown",this.onMouseDown);this.handleValue=null}});videojs.RangeSelectorDisplay.prototype.init_=function(){this.rs=this.player_.rangeslider;this.an=this.player_.annotations;this.start=0;this.end=this.an.player.duration()};videojs.RangeSelectorDisplay.prototype.options_={children:{RangeSelectorLeft:{},RangeSelectorRight:{},}};videojs.RangeSelectorDisplay.prototype.createEl=function(){return videojs.Component.prototype.createEl.call(this,"div",{className:"vjs-rangeselector-anpanel-annotation",})};videojs.RangeSelectorDisplay.prototype.onMouseDown=function(c){c.preventDefault();videojs.blockTextSelection();if(!this.rs.options.locked){videojs.on(document,"mousemove",videojs.bind(this,this.onMouseMove));videojs.on(document,"mouseup",videojs.bind(this,this.onMouseUp))}};videojs.RangeSelectorDisplay.prototype.onMouseUp=function(c){videojs.off(document,"mousemove",this.onMouseMove,false);videojs.off(document,"mouseup",this.onMouseUp,false)};videojs.RangeSelectorDisplay.prototype.onMouseMove=function(c){var d=this.calculateDistance(c);if(this.an.rsdl.pressed){this.setPosition(0,d)}else{if(this.an.rsdr.pressed){this.setPosition(1,d)}}};videojs.RangeSelectorDisplay.prototype.calculateDistance=function(e){var c=this.getRSTBX();var d=this.getRSTBWidth();var f=this.getWidth();c=c+(f/2);d=d-f;return Math.max(0,Math.min(1,(e.pageX-c)/d))};videojs.RangeSelectorDisplay.prototype.getRSTBWidth=function(){return this.el_.offsetWidth};videojs.RangeSelectorDisplay.prototype.getRSTBX=function(){return videojs.findPosition(this.el_).left};videojs.RangeSelectorDisplay.prototype.getWidth=function(){var c=$(this.an.rsdl.el_).find(".vjs-selector-arrow")[0];return c.offsetWidth};videojs.RangeSelectorDisplay.prototype.setPosition=function(e,g){var e=e||0;if(isNaN(g)){return false}if(!(e===0||e===1)){return false}var i=this.an.rsdl.el_,c=this.an.rsdr.el_,f=this.an[e===0?"rsdl":"rsdr"].el_;this.handleValue=g;if((e===0?this.updateLeft(g):this.updateRight(g))){if(e===1){f.style.left=(this.handleValue*100)+"%";f.style.width=((1-this.handleValue)*100)+"%"}else{f.style.left=(this.handleValue*100)+"%";f.style.width=((this.handleValue)*100)+"%"}this[e===0?"start":"end"]=this.rs._seconds(g);if(e===0&&(this.handleValue*100)>=90){$(i).find(".vjs-selector-arrow")[0].style.zIndex=25}else{$(i).find(".vjs-selector-arrow")[0].style.zIndex=10}var h=this.rs._seconds(parseFloat(i.style.left)/100),d=this.rs._seconds(parseFloat(c.style.left)/100);this.an.showBetween(h,d)}return true};videojs.RangeSelectorDisplay.prototype.updateLeft=function(f){var e=this.an.rsdr.el_.style.left!=""?this.an.rsdr.el_.style.left:100;var c=parseFloat(e)/100;var d=videojs.round((c-f),this.an.updatePrecision);if(f<=(c+0.00001)){return true}return false};videojs.RangeSelectorDisplay.prototype.updateRight=function(d){var c=this.an.rsdl.el_.style.left!=""?this.an.rsdl.el_.style.left:0;var e=parseFloat(c)/100;if((d+0.00001)>=e){return true}return false};videojs.RangeSelectorLeft=videojs.Component.extend({init:function(d,c){videojs.Component.call(this,d,c);this.on("mousedown",this.onMouseDown);this.pressed=false}});videojs.RangeSelectorLeft.prototype.init_=function(){this.rs=this.player_.rangeslider;this.an=this.player_.annotations};videojs.RangeSelectorLeft.prototype.createEl=function(){return videojs.Component.prototype.createEl.call(this,"div",{className:"vjs-leftselector-anpanel-annotation",innerHTML:'<div class="vjs-selector-arrow"></div><div class="vjs-leftselector-back"></div>'})};videojs.RangeSelectorLeft.prototype.onMouseDown=function(c){c.preventDefault();videojs.blockTextSelection();this.pressed=true;videojs.on(document,"mouseup",videojs.bind(this,this.onMouseUp));videojs.addClass(this.el_,"active")};videojs.RangeSelectorLeft.prototype.onMouseUp=function(c){videojs.off(document,"mouseup",this.onMouseUp,false);videojs.removeClass(this.el_,"active");this.pressed=false};videojs.RangeSelectorRight=videojs.Component.extend({init:function(d,c){videojs.Component.call(this,d,c);this.on("mousedown",this.onMouseDown);this.pressed=false}});videojs.RangeSelectorRight.prototype.init_=function(){this.rs=this.player_.rangeslider;this.an=this.player_.annotations};videojs.RangeSelectorRight.prototype.createEl=function(){return videojs.Component.prototype.createEl.call(this,"div",{className:"vjs-rightselector-anpanel-annotation",innerHTML:'<div class="vjs-selector-arrow"></div><div class="vjs-rightselector-back"></div>'})};videojs.RangeSelectorRight.prototype.onMouseDown=function(c){c.preventDefault();videojs.blockTextSelection();if(!this.rs.options.locked){this.pressed=true;videojs.on(document,"mouseup",videojs.bind(this,this.onMouseUp));videojs.addClass(this.el_,"active")}};videojs.RangeSelectorRight.prototype.onMouseUp=function(c){videojs.off(document,"mouseup",this.onMouseUp,false);videojs.removeClass(this.el_,"active");if(!this.rs.options.locked){this.pressed=false}};videojs.BackAnDisplayScroll=videojs.Component.extend({init:function(d,c){videojs.Component.call(this,d,c);this.on("mousedown",this.onMouseDown);this.UpValue=10}});videojs.BackAnDisplayScroll.prototype.init_=function(){this.rs=this.player_.rangeslider;this.an=this.player_.annotations;this.mousedownID=-1;var c=this;$(this.an.AnDisplay.el_).bind("DOMMouseScroll",function(d){if(d.originalEvent.detail>0){c.changeScroll(c.UpValue)}else{c.changeScroll(-c.UpValue)}return false});$(this.an.AnDisplay.el_).bind("mousewheel",function(d){if(d.originalEvent.wheelDelta<0){c.changeScroll(c.UpValue)}else{c.changeScroll(-c.UpValue)}return false})};videojs.BackAnDisplayScroll.prototype.createEl=function(){return videojs.Component.prototype.createEl.call(this,"div",{className:"vjs-scroll-anpanel-annotation",innerHTML:'<div class="vjs-up-scroll-annotation"></div><div class="vjs-down-scroll-annotation"></div>',})};videojs.BackAnDisplayScroll.prototype.onMouseDown=function(d){var e=d.target.className=="vjs-down-scroll-annotation"?this.UpValue:-this.UpValue,c=this;videojs.on(document,"mouseup",videojs.bind(this,this.onMouseUp));if(this.mousedownID==-1){this.mousedownID=setInterval(function(){c.changeScroll(e)},100)}};videojs.BackAnDisplayScroll.prototype.onMouseUp=function(d){videojs.off(document,"mouseup",this.onMouseUp,false);var c=this;if(this.mousedownID!=-1){clearInterval(this.mousedownID);c.mousedownID=-1}};videojs.BackAnDisplayScroll.prototype.changeScroll=function(d){var c=this.an.AnDisplay.el_;c.scrollTop=(c.scrollTop+d)};videojs.AnDisplay=videojs.Component.extend({init:function(d,c){videojs.Component.call(this,d,c);this.on("mousedown",this.onMouseDown);this.on("mouseover",this.onMouseOver)}});videojs.AnDisplay.prototype.init_=function(){this.rs=this.player_.rangeslider;this.an=this.player_.annotations;this.transition=false};videojs.AnDisplay.prototype.createEl=function(){return videojs.Component.prototype.createEl.call(this,"div",{className:"vjs-anpanel-annotation",})};videojs.AnDisplay.prototype.onMouseDown=function(h){var g=$(h.target).parents(".annotator-hl").andSelf(),d=this;if(g.hasClass("annotator-hl")){videojs.on(document,"mouseup",videojs.bind(this,this.onMouseUp));var f=document.createElement("div"),i=parseFloat(g[1].style.top),e=parseFloat(g[1].style.marginTop),c=parseFloat($(g[1]).css("height"));f.className="boxup-dashed-line";f.style.left=g[1].style.left;f.style.width=g[1].style.width;f.style.top=(i+e-this.el_.scrollTop/c)+"em";g[0].parentNode.parentNode.appendChild(f)}};videojs.AnDisplay.prototype.onMouseUp=function(h){if(typeof this.lastelem=="undefined"){return false}var g=this.lastelem,e=this;if(g.hasClass("annotator-hl")){var d=g.map(function(){return $(this).data("annotation")})[0];var f=(-1)*parseFloat($(this.el_).parent()[0].style.top),c=parseFloat($(g[1]).css("height"));$(g).parent().parent().find(".boxup-dashed-line")[0].style.top=(f-2)+"em";this.an.player.pause();this.transition=true;window.setTimeout(function(){e.an.showAnnotation(d);e.transition=false;e.onCloseViewer()},900)}videojs.off(document,"mouseup",this.onMouseUp,false)};videojs.AnDisplay.prototype.onMouseOver=function(f){if(!this.transition&&!this.an.rsdl.pressed&&!this.an.rsdr.pressed){var j=this.an.annotator;var e=$(f.target).parents(".annotator-hl").andSelf();if(typeof j!="undefined"&&j.viewer.isShown()&&e.hasClass("annotator-hl")){j.viewer.hide();var h=e.map(function(){return $(this).data("annotation")});j.showViewer($.makeArray(h),Util.mousePosition(f,j.wrapper[0]))}e.addClass("active");if(typeof e!="undefined"&&$(e[1]).hasClass("annotation")){var d=document.createElement("div"),g=document.createElement("div"),i=parseFloat(this.an.BackAnDisplay.el_.style.height),c=e[1].style.marginTop!=""?parseFloat(e[1].style.marginTop):0;ElemTop=parseFloat(e[1].style.top)+c,emtoPx=parseFloat($(e[1]).css("height"));d.className="dashed-line";g.className="box-dashed-line";d.style.left=g.style.left=e[1].style.left;d.style.width=g.style.width=e[1].style.width;d.style.top=((ElemTop+1)-this.el_.scrollTop/emtoPx)+"em";d.style.height=((i-ElemTop+1)+this.el_.scrollTop/emtoPx)+"em";g.style.top=(i+1)+"em";e[0].parentNode.parentNode.appendChild(d);e[0].parentNode.parentNode.appendChild(g);$(this.player).find(".vjs-play-progress").css("z-index",2);$(this.player).find(".vjs-seek-handle").css("z-index",2)}if(e.hasClass("annotator-hl")){this.lastelem=e}}};videojs.AnDisplay.prototype.onCloseViewer=function(){if(!this.transition){if(typeof this.lastelem!="undefined"){this.lastelem.removeClass("active")}if(typeof this.lastelem!="undefined"&&this.lastelem.hasClass("annotator-hl")){$(this.lastelem).parent().parent().find(".dashed-line").remove();$(this.lastelem).parent().parent().find(".box-dashed-line").remove();$(this.lastelem).parent().parent().find(".boxup-dashed-line").remove();$(this.player).find(".vjs-play-progress").css("z-index","");$(this.player).find(".vjs-seek-handle").css("z-index","")}}}})();Annotator.Plugin.VideoJS=(function(b){__extends(a,b);function a(){this.pluginSubmit=__bind(this.pluginSubmit,this);this.updateField=__bind(this.updateField,this);_ref=a.__super__.constructor.apply(this,arguments);this.__indexOf=[].indexOf||function(e){for(var d=0,c=this.length;d<c;d++){if(d in this&&this[d]===e){return d}}return -1};return _ref}a.prototype.field=null;a.prototype.input=null;a.prototype.pluginInit=function(){console.log("VideoJS-pluginInit");if(!Annotator.supported()){return}this.field=this.annotator.editor.addField({id:"vjs-input-rangeTime-annotations",type:"input",submit:this.pluginSubmit,EditVideoAn:this.EditVideoAn});var c='<li><span id="vjs-input-rangeTime-annotations"></span></li>',d=Annotator.$(c);Annotator.$(this.field).replaceWith(d);this.field=d[0];this.annotator.viewer.addField({load:this.updateViewer});this.initListeners();return this.input=$(this.field).find(":input")};a.prototype.updateField=function(d,c){console.log("Plug-updateField")};a.prototype.pluginSubmit=function(i,c){console.log("Plug-pluginSubmit");if(this.EditVideoAn()){var e=this.annotator.editor.VideoJS,f=this.annotator.mplayer[e],d=f.rangeslider,h=d.getValues(),g;c.media="video";c.target=c.target||{};c.target.container=f.id_||"";c.target.src=f.tag.currentSrc||"";g=(f.tag.currentSrc.substring(f.tag.currentSrc.lastIndexOf("."))).toLowerCase();c.target.ext=g||"";c.rangeTime=c.rangeTime||{};c.rangeTime.start=h.start||0;c.rangeTime.end=h.end||0;c.updated=new Date().toISOString();if(typeof c.created=="undefined"){c.created=new Date().toISOString()}}else{if(typeof c.media=="undefined"){c.media="text"}}return c.media};a.prototype.updateViewer=function(d,c){console.log("Plug-updateViewer")};a.prototype.EditVideoAn=function(){var f=$(".annotator-wrapper").parent()[0],e=window.annotator=$.data(f,"annotator"),d=(typeof e.mplayer!="undefined"),c=e.editor.VideoJS;return(d&&typeof c!="undefined"&&c!==-1)};a.prototype.isVideoJS=function(f){var i=$(".annotator-wrapper").parent()[0],h=window.annotator=$.data(i,"annotator"),c=f.rangeTime,e=(typeof h.mplayer!="undefined"),g=(typeof f.media!="undefined"&&f.media=="video"),d=(typeof c!="undefined"&&!isNaN(parseFloat(c.start))&&isFinite(c.start)&&!isNaN(parseFloat(c.end))&&isFinite(c.end));return(e&&g&&d)};a.prototype._deleteAnnotation=function(f){var h=f.target||{},c=h.container||{},i=this.annotator,e=i.mplayer[c],g=e.annotations,d;d=this.__indexOf.call(e.allannotations,f);if(d>=0){if(typeof e.allannotations[d]!="undefined"){delete e.allannotations[d]}e.rangeslider.hide();g.refreshDisplay()}};a.prototype.initListeners=function(){var g=$(".annotator-wrapper").parent()[0],f=$.data(g,"annotator");var e=this.EditVideoAn,d=this.isVideoJS,c=this;this.annotator.subscribe("annotationEditorShown",function(j,h){console.log("annotationEditorShown");for(var i in f.an){f.an[i].editAnnotation(h,j)}}).subscribe("annotationEditorHidden",function(i){console.log("annotationEditorHidden");if(e()){var h=f.editor.VideoJS;f.mplayer[h].rangeslider.hide();f.an[h].refreshDisplay()}f.editor.VideoJS=-1}).subscribe("annotationDeleted",function(h){console.log("annotationDeleted");if(d(h)){c._deleteAnnotation(h)}}).subscribe("annotationViewerShown",function(k,j){console.log("annotationViewerShown");var h=k.element.hasClass(k.classes.invert.y)?5:-5,i={top:parseFloat(k.element[0].style.top)+h,left:parseFloat(k.element[0].style.left)};k.element.css(i);k.element.find(".annotator-controls").removeClass(k.classes.showControls)});this.annotator.viewer.subscribe("hide",function(){for(var h in f.an){f.an[h].AnDisplay.onCloseViewer()}})};return a})(Annotator.Plugin);OpenVideoAnnotation=("OpenVideoAnnotation" in window)?OpenVideoAnnotation:{};OpenVideoAnnotation.Annotator=function(e,k){var d=jQuery,k=k||{};k.optionsAnnotator=k.optionsAnnotator||{};k.optionsVideoJS=k.optionsVideoJS||{};k.optionsRS=k.optionsRS||{};k.optionsOVA=k.optionsOVA||{};this.currentUser=null;this.annotator=d(e).annotator().data("annotator");var h=d(e).find("div .video-js").toArray();var j=this.mplayer={};for(var g in h){var a=h[g].id;var f=videojs(h[g],k.optionsVideoJS);this.mplayer[a]=f}this.annotator.an={};for(var g in this.mplayer){this.mplayer[g].rangeslider(d.extend(true,{},k.optionsRS));this.mplayer[g].annotations(d.extend(true,{},k.optionsOVA));this.annotator.an[g]=this.mplayer[g].annotations}this.setCurrentUser=function(l){this.currentUser=l;this.annotator.plugins.Permissions.setUser(l)};var c=this.focusedPlayer="",b=this.lastfocusPlayer="";function i(l){if(l.target.nodeName.toLowerCase()!="textarea"){j[c].annotations.pressedKey(l.which)}}(this._setupKeyboard=function(){d(document).mousedown(function(m){c="";for(var l in j){if(d(j[l].el_).find(m.target).length){c=j[l].id_}}if(b!=c){d(document).off("keyup",i);if(c!=""){d(document).on("keyup",i)}}b=c})})(this);this.annotator.addPlugin("Permissions",k.optionsAnnotator.user);this.annotator.addPlugin("Store",k.optionsAnnotator.store);this.annotator.addPlugin("Tags");this.annotator.addPlugin("Share");this.annotator.addPlugin("VideoJS");this.annotator.mplayer=this.mplayer;this.annotator.editor.VideoJS=-1;return this};OpenVideoAnnotation.Annotator.prototype.newVideoAn=function(a){return this.mplayer[a].annotations.newan()};OpenVideoAnnotation.Annotator.prototype.showDisplay=function(a){return this.mplayer[a].annotations.showDisplay()};OpenVideoAnnotation.Annotator.prototype.hideDisplay=function(a){return this.mplayer[a].annotations.hideDisplay()};OpenVideoAnnotation.Annotator.prototype.refreshDisplay=function(a){return this.mplayer[a].annotations.hideDisplay()};OpenVideoAnnotation.Annotator.prototype.setposBigNew=function(b,a){return this.mplayer[b].annotations.setposBigNew(a)};