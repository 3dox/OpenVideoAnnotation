var _ref,__bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(d,b){for(var a in b){if(__hasProp.call(b,a)){d[a]=b[a]}}function c(){this.constructor=d}c.prototype=b.prototype;d.prototype=new c();d.__super__=b.prototype;return d};Annotator.Plugin.Share=(function(b){__extends(a,b);function a(){this.updateField=__bind(this.updateField,this);_ref=a.__super__.constructor.apply(this,arguments);return _ref}a.prototype.field=null;a.prototype.input=null;a.prototype.pluginInit=function(){console.log("Share-pluginInit");if(!Annotator.supported()){return}this.field=this.annotator.editor.addField({type:"input",load:this.updateField,});var k='<div class="share-text-annotator">Share without saving:</div>',e='<div class="share-facebook-annotator button"></div>',c='<div class="share-twitter-annotator button"></div>',g='<div class="share-google-annotator button"></div>',h='<div class="share-email-annotator button"></div>',i=e+c+g+h,j='<li class="annotator-item"><div class="share-container-annotator">'+k+i+"</div></li>",f=Annotator.$(j);Annotator.$(this.field).replaceWith(f);this.field=f[0];this.buttonsActions();var d=this.initAPI();this.runAPI(d);return this.input=$(this.field).find(":input")};a.prototype.buttonsActions=function(){var c=this;$(this.field).find(".share-email-annotator").click(function(){var d=c.createAPIURL(2),e="Sharing a annotation with Open Video Annotation";body=encodeURIComponent(d);window.open("mailto:?subject="+e+"&body="+body)});$(this.field).find(".share-facebook-annotator").click(function(){var d=c.createAPIURL(2),e="https://www.facebook.com/sharer/sharer.php?s=100&p[url]="+encodeURIComponent(d)+"&p[title]="+encodeURIComponent("Open Video Annotation")+"&p[summary]="+c.getSource("ovaText");window.open(e)});$(this.field).find(".share-twitter-annotator").click(function(){var e=c.createAPIURL(2),d="https://twitter.com/intent/tweet?original_referer="+encodeURIComponent(e)+"&source=tweetbutton&url="+encodeURIComponent(e)+"&via=OpenVideoAnnotation&text="+encodeURIComponent("I want to share the next Open Video Annotation: ");window.open(d)});$(this.field).find(".share-google-annotator").click(function(){var d=c.createAPIURL(2),e="https://plus.google.com/share?url="+encodeURIComponent(d);window.open(e)})};a.prototype.createAPIURL=function(c){var e=this.annotator,i=e.editor,c=c||1,d=location.protocol+"//"+location.host+location.pathname;if(c===1){}else{if(c===2){var k=this.getSource("ovaStart"),l=this.getSource("ovaEnd"),f=this.getSource("ovaText");d+="?ovaStart="+k+"&ovaEnd="+l+"&ovaText="+f;if(i.VideoJS!==-1){var g=this.getSource("ovaContainer"),h=this.getSource("ovaSrc");d+="&ovaContainer="+g+"&ovaSrc="+h}else{var j=this.getSource("ovastartOffset"),m=this.getSource("ovaendOffset");d+="&ovastartOffset="+j+"&ovaendOffset="+m}}}return d};a.prototype.getSource=function(f){var g=this.annotator,e=g.editor,d=$(e.element).find("textarea")[0],f=f||"";if(f=="ovaText"){f=d.value}if(e.VideoJS!==-1){if(f=="ovaContainer"){f=e.VideoJS}else{if(f=="ovaSrc"){f=g.mplayer[e.VideoJS].tag.currentSrc}else{if(f=="ovaStart"){f=g.mplayer[e.VideoJS].rangeslider.getValues().start}else{if(f=="ovaEnd"){f=g.mplayer[e.VideoJS].rangeslider.getValues().end}}}}}else{var c=e.annotation;console.log(e.annotation);if(f=="ovastartOffset"){f=c.ranges[0].startOffset}else{if(f=="ovaendOffset"){f=c.ranges[0].endOffset}else{if(f=="ovaStart"){f=c.ranges[0].start}else{if(f=="ovaEnd"){f=c.ranges[0].end}}}}}return encodeURIComponent(f)};a.prototype.initAPI=function(){console.log("initAPI");var f={},l=this.getParameterByName("ovaId"),e=this.getParameterByName("ovaStart"),g=this.getParameterByName("ovaEnd"),d=this.getParameterByName("ovaContainer"),c=this.getParameterByName("ovaSrc"),k=this.getParameterByName("ovaText"),h=this.getParameterByName("ovaUser"),i=this.getParameterByName("ovastartOffset"),j=this.getParameterByName("ovaendOffset");if(l!=""){$.extend(f,{method:1,ovaId:l})}if(e!=""&&g!=""&&d!=""&&c!=""){$.extend(f,{method:2,start:e,end:g,container:d,src:c,text:k,user:h})}else{if(e!=""&&g!=""&&i!=""&&j!=""){$.extend(f,{method:2,start:e,end:g,startOffset:i,endOffset:j,text:k,user:h})}}return f};a.prototype.runAPI=function(d){var c=this;this.annotator.subscribe("annotationsLoaded",function(m){console.log("runningAPI");var g=$(".annotator-wrapper").parent()[0],i=window.annotator=$.data(g,"annotator"),s=i.mplayer;if(typeof d!="undefined"&&typeof d.method!="undefined"&&(d.method=="1"||d.method=="2")){if(d.method=="1"){console.log("method 1")}else{if(d.method=="2"){if(typeof s!="undefined"){console.log("method 2");var h=decodeURIComponent(d.container),q=s[h],f=(typeof q!="undefined"&&typeof q!="undefined"&&h==q.id_),r=(!isNaN(parseFloat(d.start))&&isFinite(d.start)&&!isNaN(parseFloat(d.end))&&isFinite(d.end)),o=false;if(f){var e=decodeURIComponent(d.src),j=e.substring(0,e.lastIndexOf(".")),l=q.tag.src==""?q.tag.currentSrc:q.tag.src;l=l.substring(0,l.lastIndexOf("."));o=(j==l)}if(f&&r&&o){var k={rangeTime:{start:d.start,end:d.end},created:new Date().toISOString(),updated:new Date().toISOString(),target:{container:h,src:e},media:"video",text:decodeURIComponent(d.text),user:decodeURIComponent(d.user)};videojs(q.id_).ready(function(){q.preload("auto");q.play();q.autoPlayAPI=k})}var n=d.startOffset,p=d.endOffset;if(!f&&typeof n!="undefined"&&typeof p!="undefined"){var k={ranges:[{start:decodeURIComponent(d.start),end:decodeURIComponent(d.end),startOffset:decodeURIComponent(d.startOffset),endOffset:decodeURIComponent(d.endOffset),}],created:new Date().toISOString(),updated:new Date().toISOString(),media:"text",text:decodeURIComponent(d.text),user:decodeURIComponent(d.user)};i.setupAnnotation(k);$(k.highlights).addClass("api");$("html,body").animate({scrollTop:$(k.highlights[0]).offset().top},"slow")}}}}}})};a.prototype.getParameterByName=function(c){c=c.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+c+"=([^&#]*)"),d=e.exec(location.search);return d==null?"":decodeURIComponent(d[1].replace(/\+/g," "))};a.prototype.updateField=function(d,c){};return a})(Annotator.Plugin);